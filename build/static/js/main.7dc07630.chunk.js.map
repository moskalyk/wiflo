{"version":3,"sources":["imgs/less_1.png","imgs/more_1.png","imgs/line.png","audio/websocket.js","audio/audioTransmitter.js","audio/audioStream.js","helpers.ts","ThreadService.ts","audio/audioBridge.js","AudioService.ts","components/Player.js","components/Space.js","components/Aura.js","App.tsx","serviceWorker.ts","ChatContext.ts","index.tsx"],"names":["module","exports","Websocket","url","binaryType","this","listeners","socketEvents","socket","WebSocket","readyState","protocol","extensions","bufferedAmount","self","reconnect","u","e","cb","addEventListener","closeEvent","dispatchEvent","code","console","log","reason","PTTWebsocket","call","appEvents","messageEvent","data","send","includes","o","JSON","parse","meta","base64String","btoa","Uint8Array","reduce","onData","byte","String","fromCharCode","prototype","event","callback","push","removeEventListener","i","l","length","splice","Object","create","defineProperty","value","enumerable","writable","AudioTransmitter","audioStreamer","audioBridge","audioRecorder","getRecorder","then","recorder","start","stop","dataToSend","constructData","metadata","user","Math","random","timestamp","Date","getTime","stringify","Writable","require","AudioContext","window","webkitAudioContext","PCM","process","audioBuffer","downsample","arr","out","Int16Array","buffer","numberOfChannels","getChannelData","abuffer","left","right","Float32Array","interleave","toWav","opts","byteLength","bytesPerSample","dataSize","numChannels","sampleRate","blockAlign","byteRate","ArrayBuffer","dv","DataView","p","writeString","s","setInt8","charCodeAt","writeUint32","d","setInt32","writeUint16","setInt16","header","Int8Array","pcm","wav","set","setIfNull","conf","prop","val","AudioStream","configuration","audioTransmitter","Promise","resolve","reject","args","audio","channelCount","navigator","mediaDevices","getUserMedia","stream","interval","startedRecording","context","mediaRecorder","MediaRecorder","Response","arrayBuffer","decodeAudioData","encoding","channels","bufferSize","duration","transmitMetadata","transmitAudioData","transmitStartData","state","setInterval","clearInterval","setTimeout","transmitStopData","catch","error","destination","autoend","play","wavBuffer","write","close","getIdentity","a","storedIdent","localStorage","getItem","Error","restored","Libp2pCryptoIdentity","fromString","fromRandom","identity","identityString","toString","setItem","message","level","dbName","ThreadService","threadID","db","room","init","key","REACT_APP_API_KEY","Database","withKeyInfo","undefined","REACT_APP_API","reset","destroy","err","storeCurrentRoom","location","hash","startNewRoom","createCollection","joinExternalRoom","invite","startFromInfo","rejoinOpenRoom","collections","get","newCollection","chatSchema","getInfoString","getDBInfo","info","insert","replace","ThreadID","fromEvent","emitter","$schema","definitions","ChatBasic","title","type","properties","_id","text","author","required","AudioBridge","thread","audioStream","ready","threadId","onMessage","subscribe","threadEvent","m","patch","AudioService","Player","document","querySelector","audioCtx","soundClips","canvas","mainSection","canvasCtx","getContext","chunks","source","createMediaStreamSource","analyser","createAnalyser","fftSize","bufferLength","frequencyBinCount","dataArray","createOscillator","g","createGain","connect","draw","WIDTH","width","HEIGHT","height","requestAnimationFrame","getByteTimeDomainData","fillStyle","fillRect","lineWidth","strokeStyle","beginPath","sliceWidth","x","y","moveTo","lineTo","stroke","visualize","onstop","clipName","prompt","clipContainer","createElement","clipLabel","deleteButton","classList","add","setAttribute","textContent","appendChild","controls","blob","Blob","audioURL","URL","createObjectURL","src","onclick","evtTgt","target","parentNode","removeChild","existingName","newClipName","ondataavailable","count","Audio","audioEl","onresize","offsetWidth","className","style","id","Component","marginTop","GeometryUtils","merge","geometry1","geometry2","materialIndexOffset","matrix","warn","THREE","matrixAutoUpdate","updateMatrix","geometry","randomPointInTriangle","vector","vectorA","vectorB","vectorC","point","b","c","copy","multiplyScalar","randomPointInFace","face","vA","vB","vC","vertices","randomPointsInGeometry","n","faces","il","totalArea","cumulativeAreas","_area","triangleArea","r","index","result","stats","binarySearch","end","mid","floor","randomPointsInBufferGeometry","attributes","position","array","vector1","vector2","subVectors","cross","center","Space","sceneSetup","mount","clientWidth","clientHeight","scene","background","camera","z","OrbitControls","renderer","setSize","domElement","addCustomSceneObjects","points","color","size","material","dots","wireframe","sphere","lights","startAnimationLoop","rotation","render","requestID","handleWindowResize","aspect","updateProjectionMatrix","cancelAnimationFrame","dispose","paddingTop","ref","innerHeight","createGeometry","vertex","normalize","audioService","Aura","props","line","parameters","essence","opacity","scale","userData","originalScale","PI","antialias","setPixelRatio","devicePixelRatio","traverse","object","isLine","lookAt","time","now","children","sin","forceUpdate","LAYERS","LAYERS1","LAYERS2","LAYERS3","UI_STATES","freeze","BEGIN","INTENT","NAV","ROOM","MAP","SPACE_STATE","FLOW","LOCAL","GLOBAL","Start","useState","isGo","setGo","cursor","onMouseEnter","onMouseLeave","onClick","setState","Nav","nav","map","State","direction","less","display","more","Header","Footer","globalToggle","React","useCallback","setControl","flowToggle","selfToggle","textDecoration","Intention","textAlign","name","placeholder","Room","setDots","participants","setParticipants","useEffect","innerWidth","alignText","Layer","Subscriptions","split","layers","record","broadcast","dial","inviteCode","getElementById","Controller","Main","control","view","App","Boolean","hostname","match","ChatContext","createContext","chat","ReactDOM","Provider","serviceWorker","registration","unregister"],"mappings":"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","file":"static/js/main.7dc07630.chunk.js","sourcesContent":["module.exports = __webpack_public_path__ + \"static/media/less_1.906bb524.png\";","module.exports = __webpack_public_path__ + \"static/media/more_1.b474c75f.png\";","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASgAAACjCAYAAAA5B4O2AAAB00lEQVR42u3YoRWAMBBEwas4NaSUOGw6QEQiKIFSDjAoCjgx89628MVGAFSVmduzy8ys2t5A7QlQkEABAgUgUIBAAQgUIFAAAgUgUIBAAQgUIFAAAgUgUIBAAQgUIFAAAgUgUIBAAQgUIFAAAgUgUIBAAQgUIFAAAgUgUIBAAQgUIFAAAgUIFIBAAQgUIFAAAgUIFIBAAQgUIFAAAgUIFIBAAQgUIFAAAgUIFIBAAQgUIFAAAgUIFIBAAQgUIFAAAgUIFIBAAQIlUIBAAQgUIFAAAgUIFIBAAQgUIFAAAgUIFIBAAQgUIFAAAgUIFIBAAfwEaq11jDHSzKzaorV2RUSamZXbnPPsvaeZWbX5oAAnOYBAAQIFIFCAQAEIFIBAAQIFIFCAQAEIFIBAAQIFIFCAQAEIFIBAAQIFIFCAQAEIFIBAAQIFIFCAQAEIFIBAAQIFIFCAQAEIFCBQAAIFIFCAQAEIFCBQAAIFIFCAQAEIFCBQAAIFIFCAQAEIFCBQAAIFIFCAQAEIFCBQAAIFIFCAQAEIFCBQAAIFCJRAAQIFIFCAQAEIFCBQAAIFIFCAQAEIFCBQAAIFIFCAQAEIFCBQAAIFIFCAQAEIFCBQAAIF8LkBHxC8fZTjPaMAAAAASUVORK5CYII=\"","/**\n * Wrapper class for { WebSocket }.\n * \n * @param {string} url \n * @param {string} binaryType -> 'blob' or 'arraybuffer'\n */\nfunction Websocket(url, binaryType=\"blob\"){\n    this.url = url;\n    this.listeners = {};\n    this.socketEvents = ['open', 'close', 'error', 'message'];\n    \n    this.socket = new WebSocket(url);\n    this.readyState = this.socket.readyState;\n    this.protocol = this.socket.protocol;\n    this.extensions = this.socket.extensions;\n    this.bufferedAmount = this.socket.bufferedAmount;\n    this.binaryType = binaryType;\n    this.socket.binaryType = this.binaryType;\n    \n    var self = this;\n\n    var reconnect = (u) =>{\n        var socket = new WebSocket(u);\n        socket.binaryType = this.socket.binaryType;\n\n        for (var e in this.socketEvents){\n            for(var cb in this.listeners[e]){\n                socket.addEventListener(e, cb);\n            }\n        }\n        this.socket.addEventListener('close', closeEvent);\n        this.socket = socket;\n        this.dispatchEvent('reconnect', this.socket);\n    }\n\n    function closeEvent (e){\n        if(e.code == 1011){\n            console.log(`Could not connect to websocket. reason=${e.reason}`);\n        }else{\n            reconnect(self.url);\n        }\n    }\n\n    this.socket.addEventListener('close', closeEvent);    \n}\n\nWebsocket.prototype.addEventListener = function(event, callback){\n    if(this.socketEvents.includes(event)){\n        this.socket.addEventListener(event, callback);\n    }\n    if (!( event in this.listeners )){\n        this.listeners[event] = []\n    }\n    this.listeners[event].push(callback);\n}\n\nWebsocket.prototype.removeEventListener = function(event, callback){\n    if (!( event in this.listeners )){\n        return;\n    }\n    for (var i = 0, l = this.listeners[event].length; i < l; i++) {\n        if (this.listeners[event][i] === callback){\n            this.listeners[event].splice(i, 1);\n            return;\n        }\n    }\n}\n\nWebsocket.prototype.dispatchEvent = function(event, data){\n    if (!( event in this.listeners )){\n        return;\n    }\n    for(var i=0; i < this.listeners[event].length; i++){\n        this.listeners[event][i].call(this, data);\n    }\n}\n\nWebsocket.prototype.send = function(data){\n    this.socket.send(data);\n}\n\nfunction PTTWebsocket(url, binaryType=\"arraybuffer\"){\n    Websocket.call(this, url, binaryType);\n    this.appEvents = ['started', 'stopped']\n\n    var messageEvent = (e) =>{\n        if (typeof e.data === \"string\"){\n            \n            if(e.data == 'ping'){ // keep-alive\n                this.socket.send('pong');\n            }else if(this.appEvents.includes(e.data)){\n                this.dispatchEvent(e.data, e);\n            }else{\n                try{\n                    var o = JSON.parse(e.data);\n                    if('meta' in o){\n                        this.dispatchEvent('metadata', o.meta);\n                    }else{\n                        // do nothing for now!\n                    }\n                }catch(e){\n                    // do nothing!\n                }\n            }\n\n        }else{\n            var base64String = btoa(\n                new Uint8Array(e.data)\n                    .reduce((onData, byte) => onData + String.fromCharCode(byte), ''));\n\n            this.dispatchEvent('binary', base64String);\n        }\n    }\n\n    this.addEventListener('message', messageEvent);\n}\n\nPTTWebsocket.prototype = Object.create(Websocket.prototype);\n\nObject.defineProperty(PTTWebsocket.prototype, 'constructor', { \n    value: PTTWebsocket, \n    enumerable: false, \n    writable: true \n});\n\n","import AudioStream from './audioStream.js';\nimport audioBridge from './audioBridge.js';\n  var audioRecorder;\n\nexport default class AudioTransmitter {\n  audioRecorder = null\n  \n  constructor(audioStreamer, audioBridge){\n      // this.as = audioStreamer\n      this.audioStreamer = audioStreamer\n      this.audioBridge = audioBridge\n\n      this.audioStreamer.getRecorder().then(recorder => {\n        this.audioRecorder = recorder;\n      });\n  }\n\n   start() {\n    audioRecorder.start();\n  }\n\n  stop() {\n    audioRecorder.stop();\n  }\n\n  transmitAudioData(data) {\n    var base64String = btoa(\n      new Uint8Array(data)\n        .reduce((onData, byte) => onData + String.fromCharCode(byte), ''));\n\n    var dataToSend = this.constructData('binary', base64String)\n    this.audioBridge.send(dataToSend);\n  }\n\n  transmitMetadata(metadata) {\n    var dataToSend = this.constructData('metadata', metadata);\n    this.audioBridge.send(dataToSend);\n  }\n\n  transmitStartData() {\n    var dataToSend = this.constructData('started', 'started')\n    this.audioBridge.send(dataToSend);\n  }\n\n  transmitStopData() {\n    var dataToSend = this.constructData('stopped', 'stopped')\n    this.audioBridge.send(dataToSend);\n  }\n\n  constructData(event, data) {\n    var dataToSend = {}\n\n    // dataToSend.user = gunDB._.opt.pid\n\n    // hack\n    dataToSend.user = Math.random()\n    dataToSend.event = event\n    dataToSend.timestamp = new Date().getTime();\n\n    if (event == 'metadata') {\n      dataToSend.data = JSON.stringify(data);\n    } else if (event == 'binary') {\n      dataToSend.data = data;\n    }\n\n    return dataToSend;\n  }\n\n}\n","import './websocket.js';\nimport AudioTransmitter from './audioTransmitter.js';\n\n\nvar Writable = require('web-audio-stream/writable');\nvar AudioContext = window.AudioContext || window.webkitAudioContext;\n\nconst SECOND = 1000;\nconst TARGET_ENCODING = 16;\nconst DEFAULT_SAMPLE_RATE = 44100;\nconst DEFAULT_CHANNELS = 1;\nconst DEFAULT_DURATION = 0.5;\nconst DEFAULT_STOP_DELAY = 1.2;\n\n\n/**\n * Utility object for processing raw PCM data.\n */\nconst PCM = function () {\n\n    /**\n     * Processes raw PCM into an arraybuffer.\n     * Performs downsampling from float to 16-bit and interleaves stereo channels.\n     * \n     * @param {AudioBuffer} audioBuffer \n     * @returns {ArrayBuffer} \n     */\n    function process(audioBuffer) {\n        function downsample(arr) {\n            var out = new Int16Array(arr.length);\n            for (var i = 0; i < arr.length; i++) {\n                out[i] = arr[i] * 0xFFFF;\n            }\n            return out.buffer;\n        }\n\n        function interleave(abuffer) {\n            var arr = [];\n            for (var i = 0; i < abuffer.getChannelData(0).length; i++) {\n                var left = abuffer.getChannelData(0)[i];\n                var right = abuffer.getChannelData(1)[i];\n                arr.push(left);\n                arr.push(right);\n            }\n            return new Float32Array(arr);\n        }\n\n        if (audioBuffer.numberOfChannels == 1) {\n            return downsample(audioBuffer.getChannelData(0));\n        }\n\n        var interleaved = interleave(audioBuffer);\n        return downsample(interleaved);\n    }\n\n    /**\n     * Converts raw PCM into WAV.\n     * \n     * @param {numChannels, sampleRate, bytesPerSample} opts \n     * @param {ArrayBuffer} data \n     * @returns {ArrayBuffer}\n     */\n    function toWav(opts, data) {\n\n        var numFrames = data.byteLength / opts.bytesPerSample;\n        var numChannels = opts.numChannels || 1;\n        var sampleRate = opts.sampleRate || 44100;\n        var bytesPerSample = opts.bytesPerSample || 2;\n        var blockAlign = numChannels * bytesPerSample;\n        var byteRate = sampleRate * blockAlign;\n        var dataSize = numFrames * blockAlign;\n        dataSize = data.byteLength;\n\n        var buffer = new ArrayBuffer(44);\n        var dv = new DataView(buffer);\n\n        var p = 0;\n\n        function writeString(s) {\n            for (var i = 0; i < s.length; i++) {\n                dv.setInt8(p + i, s.charCodeAt(i));\n            }\n            p += s.length;\n        }\n\n        function writeUint32(d) {\n            dv.setInt32(p, d, true);\n            p += 4;\n        }\n\n        function writeUint16(d) {\n            dv.setInt16(p, d, true);\n            p += 2;\n        }\n\n        writeString('RIFF');              // ChunkID\n        writeUint32(dataSize + 36);       // ChunkSize\n        writeString('WAVE');              // Format\n        writeString('fmt ');              // Subchunk1ID\n        writeUint32(16);                  // Subchunk1Size\n        writeUint16(1);                   // AudioFormat\n        writeUint16(numChannels);         // NumChannels\n        writeUint32(sampleRate);          // SampleRate\n        writeUint32(byteRate);            // ByteRate\n        writeUint16(blockAlign);          // BlockAlign\n        writeUint16(bytesPerSample * 8);  // BitsPerSample\n        writeString('data');              // Subchunk2ID\n        writeUint32(dataSize);            // Subchunk2Size\n\n        var header = new Int8Array(buffer);\n        var pcm = new Int8Array(data);\n        var wav = new Int8Array(header.byteLength + pcm.byteLength);\n        wav.set(header);\n        wav.set(pcm, header.byteLength);\n        return wav.buffer;\n    }\n\n    return {\n        process,\n        toWav\n    }\n\n}();\n\n    function setIfNull(conf, prop, val) {\n        if (!(prop in conf)) {\n            conf[prop] = val;\n        }\n    }\n/**\n * AudioStream class for sending and receiving audio in 'almost' real-time.\n */\nexport default class AudioStream {\n\n    \n    constructor(audioBridge) {\n        // configuration\n        this.configuration = {}\n        this.audioTransmitter = new AudioTransmitter(this, audioBridge)\n        const SECOND = 1000;\n        const TARGET_ENCODING = 16;\n        const DEFAULT_SAMPLE_RATE = 44100;\n        const DEFAULT_CHANNELS = 1;\n        const DEFAULT_DURATION = 0.5;\n        const DEFAULT_STOP_DELAY = 1.2;\n\n\n        setIfNull(this.configuration, 'sampleRate', DEFAULT_SAMPLE_RATE);\n        setIfNull(this.configuration, 'channelCount', DEFAULT_CHANNELS);\n        setIfNull(this.configuration, 'duration', DEFAULT_DURATION);\n        setIfNull(this.configuration, 'stopDelay', DEFAULT_STOP_DELAY);\n    }\n\n\n    getRecorder () {\n        var self = this\n        return new Promise((resolve, reject) => {\n            var args = {\n                audio: {\n                    sampleRate: this.configuration.sampleRate,\n                    channelCount: this.configuration.channelCount\n                }\n            };\n            navigator.mediaDevices.getUserMedia(args)\n                .then(stream => {\n                    var startedRecording = false;\n                    var context = new AudioContext();\n                    const mediaRecorder = new MediaRecorder(stream);\n\n                    mediaRecorder.addEventListener(\"dataavailable\", event => {\n                        new Response(event.data).arrayBuffer().then(buffer => {\n                            // MediaRecorder does not support PCM out of the box -> output needs to be decoded into PCM\n                            context.decodeAudioData(buffer, audioBuffer => {\n                                if (startedRecording) { // sends meta-data first\n                                    var meta = {\n                                        encoding: TARGET_ENCODING,\n                                        sampleRate: audioBuffer.sampleRate,\n                                        channels: audioBuffer.numberOfChannels,\n                                        bufferSize: audioBuffer.sampleRate * audioBuffer.numberOfChannels * this.configuration.duration // approximation based on sampleDuration\n                                    }\n                                    self.audioTransmitter.transmitMetadata(JSON.stringify({ meta }))\n                                    startedRecording = false;\n                                    return\n                                }\n\n                                var data = PCM.process(audioBuffer);\n                                self.audioTransmitter.transmitAudioData(data);\n                            })\n                        });\n                    });\n\n                    var interval;\n\n                    var start = () => {\n                        self.audioTransmitter.transmitStartData('started');\n\n                        if (mediaRecorder.state == 'recording') {\n                            mediaRecorder.stop();\n                        }\n\n                        mediaRecorder.start();\n                        startedRecording = true;\n\n                        interval = setInterval(() => {\n                            mediaRecorder.stop();\n                            mediaRecorder.start();\n                        }, this.configuration.duration * SECOND);\n                    };\n\n                    var stop = () => {\n                        clearInterval(interval);\n                        mediaRecorder.stop();\n                        setTimeout(() => {\n                            self.audioTransmitter.transmitStopData('stopped');\n                        }, this.configuration.duration * SECOND);\n                    };\n\n                    resolve({ start, stop });\n                }).catch(error => {\n                    reject(error);\n                });\n\n        });\n    }\n\n    getNewPlayer (metadata) {\n        var context = new AudioContext();\n        var writable = Writable(context.destination, {\n            context: context,\n            autoend: true\n        });\n\n        /**\n         * Plays audio.\n         * @param {ArrayBuffer} data \n         */\n        function play(data) {\n            var opts = {\n                numChannels: metadata.channels,\n                sampleRate: metadata.sampleRate,\n                bytesPerSample: metadata.encoding / 8\n            };\n            var wavBuffer = PCM.toWav(opts, data);\n            context.decodeAudioData(wavBuffer, audioBuffer => {\n                writable.write(audioBuffer);\n            });\n        }\n\n        function stop() {\n            context.close();\n        }\n\n        return {\n            play,\n            stop,\n        }\n    }\n\n}\n","import {Libp2pCryptoIdentity} from '@textile/threads-core'\n// @ts-ignore\nimport { uniqueNamesGenerator, animals, colors } from 'unique-names-generator'\n\n/**\n * Creates a new random keypair-based Identity\n * \n * The identity will be cached in the browser for later\n * sessions.\n */\nexport const getIdentity = (async (): Promise<Libp2pCryptoIdentity> => {\n  try {\n    var storedIdent = localStorage.getItem(\"identity\")\n    if (storedIdent === null) {\n      throw new Error('No identity')\n    }\n    const restored = Libp2pCryptoIdentity.fromString(storedIdent)\n    return restored\n  }\n  catch (e) {\n    /**\n     * If any error, create a new identity.\n     */\n    try {\n      const identity = await Libp2pCryptoIdentity.fromRandom()\n      const identityString = identity.toString()\n      localStorage.setItem(\"identity\", identityString)\n      return identity\n    } catch (err) {\n      return err.message\n    }\n  }\n})\n\n\nexport const getUsername = (async (): Promise<string> => {\n  try {\n    var storedIdent = localStorage.getItem(\"username\")\n    if (storedIdent === null) {\n      throw new Error('No username')\n    }\n    return storedIdent\n  }\n  catch (e) {\n    /**\n     * If any error, create a new identity.\n     */\n    try {\n      const shortName = uniqueNamesGenerator({ dictionaries: [animals, colors], length: 1}) \n      localStorage.setItem(\"username\", shortName)\n      return shortName\n    } catch (err) {\n      return err.message\n    }\n  }\n})","import { DBInfo } from \"@textile/threads\";\nimport {Libp2pCryptoIdentity} from '@textile/threads-core';\nimport { Collection, Database, KeyInfo, JSONSchema, ThreadID } from \"@textile/hub\";\nimport { ChatInstance } from './types';\nimport { getIdentity } from './helpers';\nimport { fromEvent, Observable } from 'rxjs';\n\n// We'll use this directly to delete our dbs when needed\nconst level = require(\"level\");\nconst dbName = \"threads.chat.reboot\";\n\nexport class ThreadService {\n  public threadID: ThreadID\n  private db?: Database\n  private identity?: Libp2pCryptoIdentity\n  private room?: Collection<ChatInstance>\n\n  constructor () {\n    // Create a default threadID to use if no room is joined\n    const room = window.location.hash.replace('#', '')\n    this.threadID = room ? ThreadID.fromString(room) : ThreadID.fromRandom()\n\n\n  }\n  \n  public init  = async (): Promise<ThreadService> => {\n    // Create or restore identity from localStorage\n    this.identity = await getIdentity()\n\n    /* You'll need to include this information in your app */\n    const key: KeyInfo = {key: process.env.REACT_APP_API_KEY || 'bq5t3vy4nh4bv6chuveibkjlw5y'}\n    // We could also consider prefixing the db by identity (or some # of chars from the public key)\n    this.db = await Database.withKeyInfo(key, dbName, undefined, process.env.REACT_APP_API) // final variable can be undefined\n    return this;\n  } \n\n  /**\n   * Reset the current db.\n   * Done by first closing it if open, deleting the existing data, and re-initializing.\n   */\n  public reset = async (): Promise<ThreadService> => {\n    console.log('closing')\n\n    try{\n      console.log(this.db)\n      await this.db?.close()\n      console.log('closed!!!')\n    }catch(e){\n      console.log(e)\n    }\n\n    console.log('destroy')\n    // This will actually \"destroy\" the database. This is handy here because we're \"switching\" rooms.\n    // But it might NOT be want you want in a real-world app!\n    await new Promise<void>((resolve, reject) => {\n      level.destroy(dbName, (err?: Error) => {\n        if (err !== undefined) reject(err)\n        resolve()\n      })\n    })\n    console.log('initinnnng')\n    return this.init()\n  };\n\n  /**\n   * Stores the threadId as a string in the URL\n   * Allows for simple refresh / returning to room\n   */\n  public storeCurrentRoom = () => {\n    const room = this.threadID.toString()\n    window.location.hash = room\n  }\n\n  /**\n   * Uses the default threadID to start a new thread and chat room\n   */\n  public startNewRoom = async () => {\n    console.log('starting room')\n    if (!this.identity) {\n      throw new Error('Identity not found')\n    }\n    if (!this.db) {\n      throw new Error('Database not setup')\n    }\n    /** Start with an empty thread */\n    await this.reset() // Reset deletes any existing data for us\n    console.log('starting')\n    console.log(this.identity)\n    console.log(this.threadID)\n    try{\n      await this.db.start(this.identity, {threadID: this.threadID})\n\n    }catch(e){\n      console.log(e)\n    }\n\n    console.log('collection')\n    await this.createCollection()\n    this.storeCurrentRoom()\n    return this.threadID\n  }\n  \n  /**\n   * Uses the result of getDBInfo to join a remote room\n   * @param invite the parsed value returned from getDBInfo\n   */\n  public joinExternalRoom = async (invite: DBInfo) => {\n    console.log('joining room')\n    // debugger\n    if (!this.identity) {\n      throw new Error('Identity not found')\n    }\n    // Since we're joining an external room, we'll reset our local db and context.\n    // This might NOT be what you want to do in a real-world app!\n    await this.reset();\n\n    if (!this.db) {\n      throw new Error('Database not setup')\n    }\n\n    console.log('payload')\n    console.log(this.identity)\n    console.log(invite)\n    console.log(this.db)\n    /** Join from the Invite payload */\n    const err = await this.db.startFromInfo(this.identity, invite)\n    if (err instanceof Error) throw err\n    this.threadID = this.db.threadID || this.threadID\n    console.log('creating collection')\n\n    await this.createCollection()\n    \n    console.log('store current room')\n\n    this.storeCurrentRoom()\n    console.log('returning with id')\n    return this.threadID\n  }\n\n  /**\n   * Restart a DB already after a browser refresh\n   */\n  public rejoinOpenRoom = async () => {\n    if (!this.identity) {\n      throw new Error('Identity not found')\n    }\n    if (!this.db) {\n      throw new Error('Database not setup')\n    }\n\n    await this.db.start(this.identity, {threadID: this.threadID})\n    // await this.db.start(this.identity)\n    await this.createCollection()\n    this.threadID = this.db.threadID || this.threadID\n    return this.db.threadID\n  }\n  \n  /**\n   * Creates a collection using the Chat schema (ChatInstance)\n   * If the chat thread already exists, this will reconnect it with `get`.\n   * \n   * Note: You can create multiple \"rooms\" in the same thread, as different\n   * collections with different names. Image a shared workplace chat.\n   */\n  public createCollection = async () => {\n    console.log('create collection')\n\n    if (!this.db) {\n      throw new Error('No db')\n    }\n    const {collections} = this.db\n    if (collections.get('basic-chat')) {\n      /** Chat exists, so just use it as the reference */\n      this.room = collections.get('basic-chat')\n    } else {\n      /** Chat doesn't exist, create it */\n      this.room = await this.db.newCollection<ChatInstance>('basic-chat', chatSchema)\n    }\n    this.storeCurrentRoom()\n  }\n  /**\n   * This will export the \"invite\" necessary for other to join the same thread.\n   * \n   * Note, recipients will have access to all collections in the same thread.\n   */\n  public getInfoString = async () => {\n    if (!this.db) {\n      throw new Error('No db')\n    }\n    const info = await this.db.getDBInfo(true)\n    return JSON.stringify(info)\n  }\n\n  /**\n   * Will broadcast a message over the thread\n   * @param message ChatInstance\n   */\n  public send = async (message: ChatInstance) => {\n    if (!this.room) {\n      throw new Error('DB not ready')\n    }\n    await this.room.insert(message)\n\n    if (!this.db || !this.db.threadID) {\n      throw new Error('DB not ready')\n    }\n  }\n\n  /**\n   * Provides an Observable to wire into the UI state\n   */\n  public onMessage (): Observable<ChatInstance> {\n    if (!this.db) {\n      throw new Error('DB not setup')\n    }\n    return fromEvent(this.db.emitter, 'basic-chat.*.0')\n  }\n\n  /**\n   * disconnect - used when unmounting\n   */\n  public disconnect (): void {\n    if (!this.db) {\n      return\n    }\n    this.db.close()\n  }\n}\n\nexport const chatSchema: JSONSchema = {\n  $schema: \"http://json-schema.org/draft-07/schema#\",\n  definitions: {\n    ChatBasic: {\n      title: \"ChatBasic\",\n      type: \"object\",\n      properties: {\n        _id: {\n          type: \"string\",\n        },\n        text: {\n          type: \"string\",\n        },\n        author: {\n          type: \"string\",\n        },\n      },\n      required: [\"text\", \"author\", \"_id\"],\n    },\n  },\n};\n","import audioReceiver from './audioReceiver.js';\nimport AudioStream from './audioStream.js';\nimport { ThreadService } from '../ThreadService';\n\nclass AudioBridge {\n\n  constructor() {\n        // init store\n    this.thread = new ThreadService()\n    this.audioStream = new AudioStream(this)\n    this.ready = false;\n\n\n  }\n\n  init () {\n\n    this.audioStream.getRecorder().then(recorder => {\n      recorder.start()\n    })\n\n    this.thread.init().then((thread) => {\n\n      console.log('init audio bridge')\n      // this.thread = thread\n      this.ready = true\n      // this.setupObservables()\n      // let room = window.location.hash.replace('#', '');\n      // if (room && room !== '') {\n      //   thread.rejoinOpenRoom().then((threadID: ThreadID) => {\n      //     // this.setRoom(threadID)\n      //     console.log(threadID)\n      //   })\n      // } \n\n      this.thread.startNewRoom().then( threadId => {\n        console.log(`Thread ready: ${threadId}`)\n        // thread.setRoom()\n        // this.ready = true;\n        console.log(this.thread)\n\n        const observable = this.thread.onMessage();\n\n        observable.subscribe((threadEvent) => {\n          const m = threadEvent.event.patch;\n          console.log('------------------')\n          console.log(m)\n\n          // messages.push(m);\n          // this.setState({ messages: messages });\n        });\n\n        this.thread.getInfoString().then((info) => {\n          console.log(\"INFO\")\n          console.log(info)\n          // const b = Buffer.from(info)\n          // console.log(b)\n          // console.log({invite: b.toString('hex')})\n          // this.setState({invite: b.toString('hex')})\n          // this.setupObservables()\n        })\n      }).catch(e => {\n        console.log(e)\n      })\n\n    })\n  }\n\n  joinExternal() {\n\n  }\n\n  send(data, room) {\n\n    if(this.ready){\n      this.thread.send({\n        // _id: Math.random(),\n        _id: '',\n        author: 'vitalik' +Math.random(),\n        text: data\n      })\n    }else {\n      console.log('not ready')\n    }\n\n  }\n\n}\n\n// var audioBridge = (function () {\n\n//   var lastTimeStamp = new Date().getTime();\n//   var initial = true;\n\n//   function init() {\n\n\n//     // receive data\n//       // audioReceiver.receive(data)\n    \n\n//     // gunDB.get('audio').get(room).on(function (data, room) {\n\n//     //   if (initial) {\n//     //     initial = false;\n//     //     return;\n//     //   }\n\n//     //   if (lastTimeStamp == data.timestamp) {\n//     //     return;\n//     //   }\n//     //   lastTimeStamp = data.timestamp;\n\n//     //   if (data.user == gunDB._.opt.pid) {\n//     //     return;\n//     //   }\n\n//     //   audioReceiver.receive(data)\n//     // })\n//   }\n\n\n\n//   return {\n//     init: init,\n//     send: sendToStore\n//   };\n\n// })();\n\n// const audioBridge = new AudioBridge ()\n\nexport default AudioBridge;","// require('./audio/audioBridge.js')\n// require('./audio/audioStream.js')\n// require('./audio/audioReceiver.js')\n// require('./audio/audioTransmitter.js')\nimport AudioBridge from './audio/audioBridge.js';\n\nimport { Collection, Database, KeyInfo, JSONSchema, ThreadID } from \"@textile/hub\";\n\n\nexport class AudioService {\n  public threadID?: ThreadID\n  private db?: Database\n  public audioBridge?: any\n\n  constructor () {\n    // Create a default threadID to use if no room is joined\n    // const room = window.location.hash.replace('#', '')\n    // this.threadID = room ? ThreadID.fromString(room) : ThreadID.fromRandom()\n  \tthis.audioBridge = new AudioBridge()\n    this.audioBridge.init()\n  }\n  \n  // public init  = async (): Promise<AudioService> => {\n  public init  = async (): Promise<any> => {\n  \tconsole.log('initialing audio')\n  \t// connect\n\n  \t// send data\n\n  \tsetInterval(() => {\n  \t\tconsole.log('testing')\n  \t\tthis.audioBridge.send('howdie')\n  \t}, 1000)\n  } \n}\n\nfunction str2ab(str:any ) {\n    var buf = new ArrayBuffer(str.length);\n    var bufView = new Uint8Array(buf);\n    for (var i = 0, strLen = str.length; i < strLen; i++) {\n        bufView[i] = str.charCodeAt(i);\n    }\n    bufView = new Uint8Array([])\n    return buf;\n}","import React, { Component } from 'react'\n\n\nclass Player extends Component {\n  \n  componentDidMount(){\n    // set up basic variables for app\n\nconst record = document.querySelector('.record');\nconst stop = document.querySelector('.stop');\nconst soundClips = document.querySelector('.sound-clips');\nconst canvas = document.querySelector('.visualizer');\nconst mainSection = document.querySelector('.main-controls');\n\n// disable stop button while not recording\n\n// stop.disabled = true;\n\n// visualiser setup - create web audio api context and canvas\n\nlet audioCtx;\nconst canvasCtx = canvas.getContext(\"2d\");\n\n//main block for doing the audio recording\n\nif (navigator.mediaDevices.getUserMedia) {\n  console.log('getUserMedia supported.');\n\n  const constraints = { audio: true };\n  let chunks = [];\n\n  let onSuccess = function(stream) {\n    const mediaRecorder = new MediaRecorder(stream);\n\n    visualize(stream);\n    \n    console.log(stream)\n\n    // record.onclick = function() {\n    //   mediaRecorder.start(1000);\n    //   console.log(mediaRecorder.state);\n    //   console.log(\"recorder started\");\n    //   record.style.background = \"red\";\n\n    //   stop.disabled = false;\n    //   record.disabled = true;\n    // }\n\n    // stop.onclick = function() {\n    //   mediaRecorder.stop();\n    //   console.log(mediaRecorder.state);\n    //   console.log(\"recorder stopped\");\n    //   record.style.background = \"\";\n    //   record.style.color = \"\";\n    //   // mediaRecorder.requestData();\n\n    //   stop.disabled = true;\n    //   record.disabled = false;\n    // }\n\n    mediaRecorder.onstop = function(e) {\n      console.log(\"data available after MediaRecorder.stop() called.\");\n\n      const clipName = prompt('Enter a name for your sound clip?','My unnamed clip');\n\n      const clipContainer = document.createElement('article');\n      const clipLabel = document.createElement('p');\n      const audio = document.createElement('audio');\n      const deleteButton = document.createElement('button');\n\n      clipContainer.classList.add('clip');\n      audio.setAttribute('controls', '');\n      // deleteButton.textContent = 'Delete';\n      // deleteButton.className = 'delete';\n\n      if(clipName === null) {\n        clipLabel.textContent = 'My unnamed clip';\n      } else {\n        clipLabel.textContent = clipName;\n      }\n\n      clipContainer.appendChild(audio);\n      clipContainer.appendChild(clipLabel);\n      clipContainer.appendChild(deleteButton);\n      soundClips.appendChild(clipContainer);\n\n      audio.controls = true;\n      const blob = new Blob(chunks, { 'type' : 'audio/ogg; codecs=opus' });\n      chunks = [];\n      const audioURL = window.URL.createObjectURL(blob);\n      audio.src = audioURL;\n      console.log(\"recorder stopped\");\n\n      deleteButton.onclick = function(e) {\n        let evtTgt = e.target;\n        evtTgt.parentNode.parentNode.removeChild(evtTgt.parentNode);\n      }\n\n      clipLabel.onclick = function() {\n        const existingName = clipLabel.textContent;\n        const newClipName = prompt('Enter a new name for your sound clip?');\n        if(newClipName === null) {\n          clipLabel.textContent = existingName;\n        } else {\n          clipLabel.textContent = newClipName;\n        }\n      }\n    }\n\n    mediaRecorder.ondataavailable = function(e) {\n      console.log(e.data)\n      chunks.push(e.data);\n      \n      const blob = new Blob(chunks, { 'type' : 'audio/ogg; codecs=opus' });\n      // var blob = new Blob(chunks, { 'type' : 'audio/ogg; codecs=opus' });\n      // document.querySelector(\"audio\").src = URL.createObjectURL(blob);\n      \n      if(count == 2) {\n        console.log('new audio')\n        audio.push(new Audio(URL.createObjectURL(blob)))\n        chunks = []\n        count = 0\n      }\n      \n      count++\n    }\n  }\n\n  let onError = function(err) {\n    console.log('The following error occured: ' + err);\n  }\n\n  navigator.mediaDevices.getUserMedia(constraints).then(onSuccess, onError);\n\n} else {\n   console.log('getUserMedia not supported on your browser!');\n}\n\nconst audio = []\nvar count = 0\n\nsetInterval(() => {\n  // pop of the list\n  // console.log('checking...')\n  // console.log(audio)\n  //play teh element\n  if(audio.length > 0){\n    const audioEl = audio[0]\n    // console.log(audioEl)\n    \n    audioEl.addEventListener(\"canplaythrough\", event => {\n      /* the audio is now playable; play it if permissions allow */\n      audioEl.play();\n    });\n  }\n  \n  //on stopping play of that element, queue the next one\n  \n}, 2000)\n\n\nfunction visualize(stream) {\n  if(!audioCtx) {\n    audioCtx = new AudioContext();\n  }\n\n  const source = audioCtx.createMediaStreamSource(stream);\n\n  const analyser = audioCtx.createAnalyser();\n  analyser.fftSize = 1024;\n  const bufferLength = analyser.frequencyBinCount;\n  const dataArray = new Uint8Array(bufferLength);\n\n  var o = audioCtx.createOscillator()\n  var  g = audioCtx.createGain()\n\n  source.connect(g)\n  g.connect(audioCtx.destination)\n  o.start(0)\n\n  source.connect(analyser);\n  //analyser.connect(audioCtx.destination);\n\n  draw()\n\n  function draw() {\n    const WIDTH = canvas.width\n    const HEIGHT = canvas.height;\n\n    requestAnimationFrame(draw);\n\n    analyser.getByteTimeDomainData(dataArray);\n\n    canvasCtx.fillStyle = 'rgb(255, 255, 255, 1)';\n    canvasCtx.fillRect(0, 0, WIDTH, HEIGHT);\n\n    canvasCtx.lineWidth = 2;\n    canvasCtx.strokeStyle = 'RGBA(84, 84, 84, 1)';\n\n    canvasCtx.beginPath();\n\n    let sliceWidth = WIDTH * 1.0 / bufferLength;\n    let x = 0;\n\n\n    for(let i = 0; i < bufferLength; i++) {\n\n      let v = dataArray[i] / 128.0;\n      let y = v * HEIGHT/2;\n      // console.log(y)\n      // console.log(v)\n\n      if(i === 0) {\n        canvasCtx.moveTo(x, y);\n      } else {\n        canvasCtx.lineTo(x, y);\n      }\n\n      x += sliceWidth;\n    }\n\n    canvasCtx.lineTo(canvas.width, canvas.height/2);\n    canvasCtx.stroke();\n\n  }\n}\n\nwindow.onresize = function() {\n  canvas.width = mainSection.offsetWidth;\n}\n\nwindow.onresize();\n  \n  }\n  \n  render(){\n    return(\n      <>\n        <section className=\"main-controls\" style={{width: '100%'}}>\n          <canvas className=\"visualizer\" height=\"200px\" style={{width: '500px'}}></canvas>\n          <div id=\"buttons\">\n          </div>\n        </section>\n      </>\n      )\n  }\n}\n\nexport default Player","\nimport React, { Component } from \"react\";\n\n\nimport * as THREE from 'three';\nimport {OrbitControls} from \"three/examples/jsm/controls/OrbitControls\";\n\nconst style = {\n\tmarginTop: 50,\n    height: 350 // we can control scene size by setting container dimensions\n};\n\n\nvar GeometryUtils = {\n\n\t// Merge two geometries or geometry and geometry from object (using object's transform)\n\n\tmerge: function ( geometry1, geometry2, materialIndexOffset ) {\n\n\t\tconsole.warn( 'THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead.' );\n\n\t\tvar matrix;\n\n\t\tif ( geometry2 instanceof THREE.Mesh ) {\n\n\t\t\tgeometry2.matrixAutoUpdate && geometry2.updateMatrix();\n\n\t\t\tmatrix = geometry2.matrix;\n\t\t\tgeometry2 = geometry2.geometry;\n\n\t\t}\n\n\t\tgeometry1.merge( geometry2, matrix, materialIndexOffset );\n\n\t},\n\n\t// Get random point in triangle (via barycentric coordinates)\n\t// \t(uniform distribution)\n\t// \thttp://www.cgafaq.info/wiki/Random_Point_In_Triangle\n\n\trandomPointInTriangle: function () {\n\n\t\tvar vector = new THREE.Vector3();\n\n\t\treturn function ( vectorA, vectorB, vectorC ) {\n\n\t\t\tvar point = new THREE.Vector3();\n\n\t\t\tvar a = Math.random();\n\t\t\tvar b = Math.random();\n\n\t\t\tif ( ( a + b ) > 1 ) {\n\n\t\t\t\ta = 1 - a;\n\t\t\t\tb = 1 - b;\n\n\t\t\t}\n\n\t\t\tvar c = 1 - a - b;\n\n\t\t\tpoint.copy( vectorA );\n\t\t\tpoint.multiplyScalar( a );\n\n\t\t\tvector.copy( vectorB );\n\t\t\tvector.multiplyScalar( b );\n\n\t\t\tpoint.add( vector );\n\n\t\t\tvector.copy( vectorC );\n\t\t\tvector.multiplyScalar( c );\n\n\t\t\tpoint.add( vector );\n\n\t\t\treturn point;\n\n\t\t};\n\n\t}(),\n\n\t// Get random point in face (triangle)\n\t// (uniform distribution)\n\n\trandomPointInFace: function ( face, geometry ) {\n\n\t\tvar vA, vB, vC;\n\n\t\tvA = geometry.vertices[ face.a ];\n\t\tvB = geometry.vertices[ face.b ];\n\t\tvC = geometry.vertices[ face.c ];\n\n\t\treturn GeometryUtils.randomPointInTriangle( vA, vB, vC );\n\n\t},\n\n\t// Get uniformly distributed random points in mesh\n\t// \t- create array with cumulative sums of face areas\n\t//  - pick random number from 0 to total area\n\t//  - find corresponding place in area array by binary search\n\t//\t- get random point in face\n\n\trandomPointsInGeometry: function ( geometry, n ) {\n\n\t\tvar face, i,\n\t\t\tfaces = geometry.faces,\n\t\t\tvertices = geometry.vertices,\n\t\t\til = faces.length,\n\t\t\ttotalArea = 0,\n\t\t\tcumulativeAreas = [],\n\t\t\tvA, vB, vC;\n\n\t\t// precompute face areas\n\n\t\tfor ( i = 0; i < il; i ++ ) {\n\n\t\t\tface = faces[ i ];\n\n\t\t\tvA = vertices[ face.a ];\n\t\t\tvB = vertices[ face.b ];\n\t\t\tvC = vertices[ face.c ];\n\n\t\t\tface._area = GeometryUtils.triangleArea( vA, vB, vC );\n\n\t\t\ttotalArea += face._area;\n\n\t\t\tcumulativeAreas[ i ] = totalArea;\n\n\t\t}\n\n\t\t// binary search cumulative areas array\n\n\t\tfunction binarySearchIndices( value ) {\n\n\t\t\tfunction binarySearch( start, end ) {\n\n\t\t\t\t// return closest larger index\n\t\t\t\t// if exact number is not found\n\n\t\t\t\tif ( end < start )\n\t\t\t\t\treturn start;\n\n\t\t\t\tvar mid = start + Math.floor( ( end - start ) / 2 );\n\n\t\t\t\tif ( cumulativeAreas[ mid ] > value ) {\n\n\t\t\t\t\treturn binarySearch( start, mid - 1 );\n\n\t\t\t\t} else if ( cumulativeAreas[ mid ] < value ) {\n\n\t\t\t\t\treturn binarySearch( mid + 1, end );\n\n\t\t\t\t} else {\n\n\t\t\t\t\treturn mid;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tvar result = binarySearch( 0, cumulativeAreas.length - 1 );\n\t\t\treturn result;\n\n\t\t}\n\n\t\t// pick random face weighted by face area\n\n\t\tvar r, index,\n\t\t\tresult = [];\n\n\t\tvar stats = {};\n\n\t\tfor ( i = 0; i < n; i ++ ) {\n\n\t\t\tr = Math.random() * totalArea;\n\n\t\t\tindex = binarySearchIndices( r );\n\n\t\t\tresult[ i ] = GeometryUtils.randomPointInFace( faces[ index ], geometry );\n\n\t\t\tif ( ! stats[ index ] ) {\n\n\t\t\t\tstats[ index ] = 1;\n\n\t\t\t} else {\n\n\t\t\t\tstats[ index ] += 1;\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn result;\n\n\t},\n\n\trandomPointsInBufferGeometry: function ( geometry, n ) {\n\n\t\tvar i,\n\t\t\tvertices = geometry.attributes.position.array,\n\t\t\ttotalArea = 0,\n\t\t\tcumulativeAreas = [],\n\t\t\tvA, vB, vC;\n\n\t\t// precompute face areas\n\t\tvA = new THREE.Vector3();\n\t\tvB = new THREE.Vector3();\n\t\tvC = new THREE.Vector3();\n\n\t\t// geometry._areas = [];\n\t\tvar il = vertices.length / 9;\n\n\t\tfor ( i = 0; i < il; i ++ ) {\n\n\t\t\tvA.set( vertices[ i * 9 + 0 ], vertices[ i * 9 + 1 ], vertices[ i * 9 + 2 ] );\n\t\t\tvB.set( vertices[ i * 9 + 3 ], vertices[ i * 9 + 4 ], vertices[ i * 9 + 5 ] );\n\t\t\tvC.set( vertices[ i * 9 + 6 ], vertices[ i * 9 + 7 ], vertices[ i * 9 + 8 ] );\n\n\t\t\ttotalArea += GeometryUtils.triangleArea( vA, vB, vC );\n\n\t\t\tcumulativeAreas.push( totalArea );\n\n\t\t}\n\n\t\t// binary search cumulative areas array\n\n\t\tfunction binarySearchIndices( value ) {\n\n\t\t\tfunction binarySearch( start, end ) {\n\n\t\t\t\t// return closest larger index\n\t\t\t\t// if exact number is not found\n\n\t\t\t\tif ( end < start )\n\t\t\t\t\treturn start;\n\n\t\t\t\tvar mid = start + Math.floor( ( end - start ) / 2 );\n\n\t\t\t\tif ( cumulativeAreas[ mid ] > value ) {\n\n\t\t\t\t\treturn binarySearch( start, mid - 1 );\n\n\t\t\t\t} else if ( cumulativeAreas[ mid ] < value ) {\n\n\t\t\t\t\treturn binarySearch( mid + 1, end );\n\n\t\t\t\t} else {\n\n\t\t\t\t\treturn mid;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tvar result = binarySearch( 0, cumulativeAreas.length - 1 );\n\t\t\treturn result;\n\n\t\t}\n\n\t\t// pick random face weighted by face area\n\n\t\tvar r, index,\n\t\t\tresult = [];\n\n\t\tfor ( i = 0; i < n; i ++ ) {\n\n\t\t\tr = Math.random() * totalArea;\n\n\t\t\tindex = binarySearchIndices( r );\n\n\t\t\t// result[ i ] = THREE.GeometryUtils.randomPointInFace( faces[ index ], geometry, true );\n\t\t\tvA.set( vertices[ index * 9 + 0 ], vertices[ index * 9 + 1 ], vertices[ index * 9 + 2 ] );\n\t\t\tvB.set( vertices[ index * 9 + 3 ], vertices[ index * 9 + 4 ], vertices[ index * 9 + 5 ] );\n\t\t\tvC.set( vertices[ index * 9 + 6 ], vertices[ index * 9 + 7 ], vertices[ index * 9 + 8 ] );\n\t\t\tresult[ i ] = GeometryUtils.randomPointInTriangle( vA, vB, vC );\n\n\t\t}\n\n\t\treturn result;\n\n\t},\n\n\t// Get triangle area (half of parallelogram)\n\t// http://mathworld.wolfram.com/TriangleArea.html\n\n\ttriangleArea: function () {\n\n\t\tvar vector1 = new THREE.Vector3();\n\t\tvar vector2 = new THREE.Vector3();\n\n\t\treturn function ( vectorA, vectorB, vectorC ) {\n\n\t\t\tvector1.subVectors( vectorB, vectorA );\n\t\t\tvector2.subVectors( vectorC, vectorA );\n\t\t\tvector1.cross( vector2 );\n\n\t\t\treturn 0.5 * vector1.length();\n\n\t\t};\n\n\t}(),\n\n\tcenter: function ( geometry ) {\n\n\t\tconsole.warn( 'THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead.' );\n\t\treturn geometry.center();\n\n\t}\n\n};\n\n\nclass Space extends Component {\n    componentDidMount() {\n        this.sceneSetup();\n        this.addCustomSceneObjects();\n        this.startAnimationLoop();\n        window.addEventListener('resize', this.handleWindowResize);\n    }\n\n    componentWillUnmount() {\n        window.removeEventListener('resize', this.handleWindowResize);\n        window.cancelAnimationFrame(this.requestID);\n        this.controls.dispose();\n    }\n\n    // Standard scene setup in Three.js. Check \"Creating a scene\" manual for more information\n    // https://threejs.org/docs/#manual/en/introduction/Creating-a-scene\n    sceneSetup = () => {\n        // get container dimensions and use them for scene sizing\n        const width = this.mount.clientWidth;\n        const height = this.mount.clientHeight;\n\n        this.scene = new THREE.Scene();\n        this.scene.background = new THREE.Color( 'white' );\n        this.camera = new THREE.PerspectiveCamera(\n            75, // fov = field of view\n            width / height, // aspect ratio\n            0.1, // near plane\n            1000 // far plane\n        );\n        this.camera.position.z = 9; // is used here to set some distance from a cube that is located at z = 0\n        // OrbitControls allow a camera to orbit around the object\n        // https://threejs.org/docs/#examples/controls/OrbitControls\n        this.controls = new OrbitControls( this.camera, this.mount );\n        this.renderer = new THREE.WebGLRenderer();\n        // this.renderer.setClearColorHex( 0x000000, 1 );\n        this.renderer.setSize( width, height );\n        this.mount.appendChild( this.renderer.domElement ); // mount using React ref\n    };\n\n    // Here should come custom code.\n    // Code below is taken from Three.js BoxGeometry example\n    // https://threejs.org/docs/#api/en/geometries/BoxGeometry\n    addCustomSceneObjects = () => {\n        // const geometry = new THREE.BoxGeometry(2, 2, 2);\n        \n        // const material = new THREE.MeshPhongMaterial( {\n        //     color: 0x156289,\n        //     emissive: 0x072534,\n        //     side: THREE.DoubleSide,\n        //     flatShading: true\n        // } );\n        // this.cube = new THREE.Mesh( geometry, material );\n        \n        var geometry = new THREE.SphereGeometry( 5, 32, 32 );\n        \n        var geometry1 = new THREE.SphereGeometry( 5, 32, 32 );\n        \n        \n        \n        var points = GeometryUtils.randomPointsInGeometry(geometry1, 50);//This statement worked as expected and returned an array filled with 200 points.\n        geometry1.vertices = points;\n        \n        var pointSpace = new THREE.Points( geometry1, new THREE.PointsMaterial( {\n          color: 0x0000ff,\n          size: 1\n        } ) );\n        \n        // var dots =\n        \n        var dots = new THREE.Mesh( geometry1, material );\n        // this.sphere = sphere\n        \n        this.scene.add( this.dots );\n        \n        var material = new THREE.MeshBasicMaterial( {color: 'grey', wireframe: true} );\n        \n        var sphere = new THREE.Mesh( geometry, material );\n        \n        // sphere.position.x = Math.random() * 2 - 1;\n        // sphere.position.y = Math.random() * 2 - 1;\n        // sphere.position.z = Math.random() * 2 - 1;\n        // sphere.position.normalize();\n        // sphere.position.multiplyScalar( 5 );\n\n        this.sphere = sphere\n        this.scene.add( this.sphere );\n        \n        \n        \n        const lights = [];\n        lights[ 0 ] = new THREE.PointLight( 0xffffff, 1, 0 );\n        lights[ 1 ] = new THREE.PointLight( 0xffffff, 1, 0 );\n        lights[ 2 ] = new THREE.PointLight( 0xffffff, 1, 0 );\n\n        lights[ 0 ].position.set( 0, 200, 0 );\n        lights[ 1 ].position.set( 100, 200, 100 );\n        lights[ 2 ].position.set( - 100, - 200, - 100 );\n\n        this.scene.add( lights[ 0 ] );\n        this.scene.add( lights[ 1 ] );\n        this.scene.add( lights[ 2 ] );\n        \n        \n    };\n\n    startAnimationLoop = () => {\n        this.sphere.rotation.x += 0.001;\n        this.sphere.rotation.y += 0.001;\n        \n        this.renderer.render( this.scene, this.camera );\n\n        // The window.requestAnimationFrame() method tells the browser that you wish to perform\n        // an animation and requests that the browser call a specified function\n        // to update an animation before the next repaint\n        this.requestID = window.requestAnimationFrame(this.startAnimationLoop);\n    };\n\n    handleWindowResize = () => {\n        const width = this.mount.clientWidth;\n        const height = this.mount.clientHeight;\n\n        this.renderer.setSize( width, height );\n        this.camera.aspect = width / height;\n\n        // Note that after making changes to most of camera properties you have to call\n        // .updateProjectionMatrix for the changes to take effect.\n        this.camera.updateProjectionMatrix();\n    };\n\n    render() {\n        return (\n        \t<div>\n        \t<br />\n        \t<br />\n        \t<div style={{paddingTop: '10px'}}>\n\t        \twhere would you like to go?\n\t      \t</div>\n        \t<div style={style} ref={ref => (this.mount = ref)} />;\n        \t</div>\n        )\n    }\n}\n\n\n\n\nexport default Space;","\nimport React, { Component } from \"react\";\n\n\nimport * as THREE from 'three';\nimport {OrbitControls} from \"three/examples/jsm/controls/OrbitControls\";\n\nvar     r = 450,\n\n\t\t\t\tmouseY = 0,\n\n\t\t\t\twindowHalfY = window.innerHeight / 2,\n\n\t\t\t\tcamera, scene, renderer;\n\n\t\t// \tinit();\n\t\t// \tanimate();\n\t\t\t\n\n\n\t\t// \tfunction init() {\n\n\t\t// \t\tcamera = new THREE.PerspectiveCamera( 80, SCREEN_WIDTH / SCREEN_HEIGHT, 1, 3000 );\n\t\t// \t\tcamera.position.z = 1000;\n\n\t\t// \t\tscene = new THREE.Scene();\n\n\t\t// \t\tvar i, line, material, p,\n\t\t// \t\t\tparameters = [[ 0.25, 0xff7700, 1 ], [ 0.5, 0xff9900, 1 ], [ 0.75, 0xffaa00, 0.75 ], [ 1, 0xffaa00, 0.5 ], [ 1.25, 0x000833, 0.8 ],\n\t\t// \t\t\t\t\t       [ 3.0, 0xaaaaaa, 0.75 ], [ 3.5, 0xffffff, 0.5 ], [ 4.5, 0xffffff, 0.25 ], [ 5.5, 0xffffff, 0.125 ]];\n\n\t\t// \t\tvar geometry = createGeometry();\n\n\t\t// \t\tfor ( i = 0; i < parameters.length; ++ i ) {\n\n\t\t// \t\t\tp = parameters[ i ];\n\n\t\t// \t\t\tmaterial = new THREE.LineBasicMaterial( { color: p[ 1 ], opacity: p[ 2 ] } );\n\n\t\t// \t\t\tline = new THREE.LineSegments( geometry, material );\n\t\t// \t\t\tline.scale.x = line.scale.y = line.scale.z = p[ 0 ];\n\t\t// \t\t\tline.userData.originalScale = p[ 0 ];\n\t\t// \t\t\tline.rotation.y = Math.random() * Math.PI;\n\t\t// \t\t\tline.updateMatrix();\n\t\t// \t\t\tscene.add( line );\n\n\t\t// \t\t}\n\n\t\t// \t\trenderer = new THREE.WebGLRenderer( { antialias: true } );\n\t\t// \t\trenderer.setPixelRatio( window.devicePixelRatio );\n\t\t// \t\trenderer.setSize( SCREEN_WIDTH, SCREEN_HEIGHT );\n\t\t// \t\tdocument.body.appendChild( renderer.domElement );\n\n\t\t// \t\tdocument.addEventListener( 'mousemove', onDocumentMouseMove, false );\n\t\t// \t\tdocument.addEventListener( 'touchstart', onDocumentTouchStart, false );\n\t\t// \t\tdocument.addEventListener( 'touchmove', onDocumentTouchMove, false );\n\n\t\t// \t\t//\n\n\t\t// \t\twindow.addEventListener( 'resize', onWindowResize, false );\n\n\t\t// \t\t// test geometry swapability\n\n\t\t// \t\tsetInterval( function () {\n\n\t\t// \t\t\tvar geometry = createGeometry();\n\n\t\t// \t\t\tscene.traverse( function ( object ) {\n\n\t\t// \t\t\t\tif ( object.isLine ) {\n\n\t\t// \t\t\t\t\tobject.geometry.dispose();\n\t\t// \t\t\t\t\tobject.geometry = geometry;\n\n\t\t// \t\t\t\t}\n\n\t\t// \t\t\t} );\n\n\t\t// \t\t}, 1000 );\n\n\t\t// \t}\n\n\t\t\tfunction createGeometry(position = 0) {\n\n\t\t\t\tvar geometry = new THREE.BufferGeometry();\n\t\t\t\tvar vertices = [];\n\t\t\t\t// console.log(geometry)\n\t\t\t\t// geometry.position.x = 10\n\t\t\t\t// geometry.position.y = 20\n\t\t\t\t// geometry.position.z = 50\n\n\t\t\t\tvar vertex = new THREE.Vector3();\n\n\t\t\t\tfor ( var i = 0; i < 1200; i ++ ) {\n\n\t\t\t\t\tvertex.x = Math.random() * 2 - 1\n\t\t\t\t\tvertex.y = Math.random() * 2 - 1\n\t\t\t\t\tvertex.z = Math.random() * 2 - 1;\n\t\t\t\t\tvertex.normalize();\n\t\t\t\t\tvertex.multiplyScalar( r );\n\t\t\t\t\t\n\n\t\t\t\t\tvertices.push( vertex.x, vertex.y, vertex.z );\n\n\t\t\t\t\tvertex.multiplyScalar( Math.random() * 0.09 + 1 );\n\n\t\t\t\t\tvertices.push( vertex.x, vertex.y, vertex.z );\n\n\t\t\t\t}\n\n\t\t\t\tgeometry.setAttribute( 'position', new THREE.Float32BufferAttribute( vertices, 3 ) );\n\n\t\t\t\treturn geometry;\n\n\t\t\t}\n\n\t\t// \tfunction onWindowResize() {\n\n\t\t// \t\twindowHalfY = window.innerHeight / 2;\n\n\t\t// \t\tcamera.aspect = window.innerWidth / window.innerHeight;\n\t\t// \t\tcamera.updateProjectionMatrix();\n\n\t\t// \t\trenderer.setSize( window.innerWidth, window.innerHeight );\n\n\t\t// \t}\n\n\t\t// \tfunction onDocumentMouseMove( event ) {\n\n\t\t// \t\tmouseY = event.clientY - windowHalfY;\n\n\t\t// \t}\n\n\t\t// \tfunction onDocumentTouchStart( event ) {\n\n\t\t// \t\tif ( event.touches.length > 1 ) {\n\n\t\t// \t\t\tevent.preventDefault();\n\n\t\t// \t\t\tmouseY = event.touches[ 0 ].pageY - windowHalfY;\n\n\t\t// \t\t}\n\n\t\t// \t}\n\n\t\t// \tfunction onDocumentTouchMove( event ) {\n\n\t\t// \t\tif ( event.touches.length == 1 ) {\n\n\t\t// \t\t\tevent.preventDefault();\n\n\t\t// \t\t\tmouseY = event.touches[ 0 ].pageY - windowHalfY;\n\n\t\t// \t\t}\n\n\t\t// \t}\n\n\t\t\t//\n\n\t\t// \tfunction animate() {\n\n\t\t// \t\trequestAnimationFrame( animate );\n\n\t\t// \t\trender();\n\n\t\t// \t}\n\n\t\t// \tfunction render() {\n\n\t\t// \t\tcamera.position.y += ( - mouseY + 200 - camera.position.y ) * .05;\n\t\t// \t\tcamera.lookAt( scene.position );\n\n\t\t// \t\trenderer.render( scene, camera );\n\n\t\t// \t\tvar time = Date.now() * 0.0001;\n\n\t\t// \t\tfor ( var i = 0; i < scene.children.length; i ++ ) {\n\n\t\t// \t\t\tvar object = scene.children[ i ];\n\n\t\t// \t\t\tif ( object.isLine ) {\n\n\t\t// \t\t\t\tobject.rotation.y = time * ( i < 4 ? ( i + 1 ) : - ( i + 1 ) );\n\n\t\t// \t\t\t\tif ( i < 5 ) {\n\n\t\t// \t\t\t\t\tvar scale = object.userData.originalScale * ( i / 5 + 1 ) * ( 1 + 0.5 * Math.sin( 7 * time ) );\n\n\t\t// \t\t\t\t\tobject.scale.x = object.scale.y = object.scale.z = scale;\n\n\t\t// \t\t\t\t}\n\n\t\t// \t\t\t}\n\n\t\t// \t\t}\n\n\t\t// \t}\n\t\t\t\n\t\t\t\nclass Aura extends Component {\n\n    componentDidMount() {\n        this.sceneSetup();\n        // this.addCustomSceneObjects();\n        this.startAnimationLoop();\n        window.addEventListener('resize', this.handleWindowResize);\n        this.forceUpdate()\n        \n    }\n\n    componentWillUnmount() {\n        window.removeEventListener('resize', this.handleWindowResize);\n        // window.cancelAnimationFrame(this.requestID);\n        // this.controls.dispose();\n    }\n\n    // Standard scene setup in Three.js. Check \"Creating a scene\" manual for more information\n    // https://threejs.org/docs/#manual/en/introduction/Creating-a-scene\n    sceneSetup = () => {\n        // // get container dimensions and use them for scene sizing\n        // const width = this.mount.clientWidth;\n        // const height = this.mount.clientHeight;\n\n        // this.scene = new THREE.Scene();\n        // this.scene.background = new THREE.Color( 'white' );\n        // this.camera = new THREE.PerspectiveCamera(\n        //     75, // fov = field of view\n        //     width / height, // aspect ratio\n        //     0.1, // near plane\n        //     1000 // far plane\n        // );\n        // this.camera.position.z = 9; // is used here to set some distance from a cube that is located at z = 0\n        // // OrbitControls allow a camera to orbit around the object\n        // // https://threejs.org/docs/#examples/controls/OrbitControls\n        // this.controls = new OrbitControls( this.camera, this.mount );\n        // this.renderer = new THREE.WebGLRenderer();\n        // // this.renderer.setClearColorHex( 0x000000, 1 );\n        // this.renderer.setSize( width, height );\n        // this.mount.appendChild( this.renderer.domElement ); // mount using React ref\n        \n        this.camera = new THREE.PerspectiveCamera( 80, this.props.WIDTH / this.props.HEIGHT, 1, 3000 );\n\t\t\t\tthis.camera.position.z = 1000;\n\n\t\t\t\tthis.scene = new THREE.Scene();\n  \n        \n    //     // aura #1\n\t\t\t\t// var i, line, material, p,\n\t\t\t\t// \tparameters = [[ 0.2, 0xff7700, 1 ]];\n        \n    //     var move = new THREE.Vector3( 100, 100, 100 );\n        \n\t\t\t\t// var geometry = createGeometry(move);\n\n\t\t\t\t// for ( i = 0; i < parameters.length; ++ i ) {\n\n\t\t\t\t// \tp = parameters[ i ];\n\n\t\t\t\t// \tmaterial = new THREE.LineBasicMaterial( { color: p[ 1 ], opacity: p[ 2 ] } );\n\n\t\t\t\t// \tline = new THREE.LineSegments( geometry, material );\n\t\t\t\t// \tline.scale.x = line.scale.y = line.scale.z = p[ 0 ];\n\t\t\t\t// \tline.userData.originalScale = p[ 0 ];\n\t\t\t\t// \tline.rotation.y = Math.random() * Math.PI;\n\t\t\t\t// \tline.updateMatrix();\n\t\t\t\t\t\n\t\t\t\t\t\n\t\t\t\t// // \tline.position(move)\n\t\t\t\t// \tthis.scene.add( line );\n\n\t\t\t\t// }\n\t\t\t\t\n\t\t\t\t// // // aura #2\n\t\t\t\t\n\t\t\t\t// var i, line, material, p,\n\t\t\t\t// \tparameters = [[ 0.25, 0xff7700, 1 ], [ 0.5, 0xff9900, 1 ], [ 0.75, 0xffaa00, 0.75 ], [ 1, 0xffaa00, 0.5 ], [ 1.25, 0x000833, 0.8 ]];\n        var i, line, material, p, parameters = this.props.essence;\n        \n        \n\t\t\t\tvar geometry = createGeometry();\n\n\t\t\t\tfor ( i = 0; i < parameters.length; ++ i ) {\n\n\t\t\t\t\tp = parameters[ i ];\n\n\t\t\t\t\tmaterial = new THREE.LineBasicMaterial( { color: p[ 1 ], opacity: p[ 2 ] } );\n\n\t\t\t\t\tline = new THREE.LineSegments( geometry, material );\n\t\t\t\t\tline.scale.x = line.scale.y = line.scale.z = p[ 0 ];\n\t\t\t\t\tline.userData.originalScale = p[ 0 ];\n\t\t\t\t\tline.rotation.y = Math.random() * Math.PI;\n\t\t\t\t\tline.updateMatrix();\n\t\t\t\t\t\n\t\t\t\t\tthis.scene.add( line );\n\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tthis.scene.background = new THREE.Color( 'white' );\n\n\t\t\t\tthis.renderer = new THREE.WebGLRenderer( { antialias: true } );\n\t\t\t\tthis.renderer.setPixelRatio( window.devicePixelRatio );\n\t\t\t\tthis.renderer.setSize( this.props.WIDTH, this.props.HEIGHT );\n\t\t\t\t\n\t\t\t\t// TODO\n\t\t\t\t// document.body.appendChild( renderer.domElement );\n\n\t\t\t\t// document.addEventListener( 'mousemove', onDocumentMouseMove, false );\n\t\t\t\t// document.addEventListener( 'touchstart', onDocumentTouchStart, false );\n\t\t\t\t// document.addEventListener( 'touchmove', onDocumentTouchMove, false );\n\n\t\t\t\t//\n\n\t\t\t\t// window.addEventListener( 'resize', onWindowResize, false );\n\n\t\t\t\t// test geometry swapability\n\t\t\t\t\n\t\t\t\tvar self = this\n\n\t\t\t\tsetInterval( function () {\n\n\t\t\t\t\tvar geometry = createGeometry();\n\n\t\t\t\t\tself.scene.traverse( function ( object ) {\n\n\t\t\t\t\t\tif ( object.isLine ) {\n\n\t\t\t\t\t\t\tobject.geometry.dispose();\n\t\t\t\t\t\t\tobject.geometry = geometry;\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t} );\n\n\t\t\t\t}, 1000 );\n\t\t\t\t\n\t\t\t\tthis.mount.appendChild( this.renderer.domElement ); // mount using React ref\n    };\n\n    // Here should come custom code.\n    // Code below is taken from Three.js BoxGeometry example\n    // https://threejs.org/docs/#api/en/geometries/BoxGeometry\n    addCustomSceneObjects = () => {\n        // const geometry = new THREE.BoxGeometry(2, 2, 2);\n        \n        // const material = new THREE.MeshPhongMaterial( {\n        //     color: 0x156289,\n        //     emissive: 0x072534,\n        //     side: THREE.DoubleSide,\n        //     flatShading: true\n        // } );\n        // this.cube = new THREE.Mesh( geometry, material );\n        \n        var geometry = new THREE.SphereGeometry( 5, 32, 32 );\n        var material = new THREE.MeshBasicMaterial( {color: 'grey', wireframe: true} );\n        var sphere = new THREE.Mesh( geometry, material );\n        this.sphere = sphere\n        this.scene.add( this.sphere );\n        const lights = [];\n        lights[ 0 ] = new THREE.PointLight( 0xffffff, 1, 0 );\n        lights[ 1 ] = new THREE.PointLight( 0xffffff, 1, 0 );\n        lights[ 2 ] = new THREE.PointLight( 0xffffff, 1, 0 );\n\n        lights[ 0 ].position.set( 0, 200, 0 );\n        lights[ 1 ].position.set( 100, 200, 100 );\n        lights[ 2 ].position.set( - 100, - 200, - 100 );\n\n        this.scene.add( lights[ 0 ] );\n        this.scene.add( lights[ 1 ] );\n        this.scene.add( lights[ 2 ] );\n        \n        \n    };\n\n    startAnimationLoop = () => {\n      \n      \n        this.camera.position.y += ( - mouseY + 200 - this.camera.position.y ) * .05;\n\t\t\t\tthis.camera.lookAt( this.scene.position );\n\n\t\t\t\tthis.renderer.render( this.scene, this.camera );\n\n\t\t\t\tvar time = Date.now() * 0.0001;\n\n\t\t\t\tfor ( var i = 0; i < this.scene.children.length; i ++ ) {\n\n\t\t\t\t\tvar object = this.scene.children[ i ];\n\n\t\t\t\t\tif ( object.isLine ) {\n\n\t\t\t\t\t\tobject.rotation.y = time * ( i < 4 ? ( i + 1 ) : - ( i + 1 ) );\n\n\t\t\t\t\t\tif ( i < 5 ) {\n\n\t\t\t\t\t\t\tvar scale = object.userData.originalScale * ( i / 5 + 1 ) * ( 1 + 0.5 * Math.sin( 7 * time ) );\n\n\t\t\t\t\t\t\tobject.scale.x = object.scale.y = object.scale.z = scale;\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\t\t\t\t\n\t\t\trequestAnimationFrame( this.startAnimationLoop );\n    };\n\n    handleWindowResize = () => {\n        const width = this.mount.clientWidth;\n        const height = this.mount.clientHeight;\n\n        this.renderer.setSize( width, height );\n        this.camera.aspect = width / height;\n\n        // Note that after making changes to most of camera properties you have to call\n        // .updateProjectionMatrix for the changes to take effect.\n        this.camera.updateProjectionMatrix();\n    };\n\n    render() {\n        return <div ref={ref => (this.mount = ref)} />;\n    }\n}\n\n\t\t\t\n\t\t\t\nexport default Aura;","import React, {useState, useEffect} from 'react'\nimport { Button, Modal, InputGroup, FormControl } from 'react-bootstrap'\n// @ts-ignore\nimport {CopyToClipboard} from 'react-copy-to-clipboard'\nimport {ThreadID} from '@textile/hub'\nimport logo from './logo.svg'\nimport './App.css'\nimport { ChatInstance, ChatState } from './types'\nimport { ChatContext } from './ChatContext'\nimport { getUsername } from './helpers'\n\nimport { AudioService } from './AudioService';\n\n\nimport Player from './components/Player'\nimport Space from './components/Space'\nimport Aura from './components/Aura'\n\nimport less from './imgs/less_1.png'\nimport more from './imgs/more_1.png'\nimport line from './imgs/line.png'\n\n\nvar audioService: any;\n\n\nfunction launchSpace(){\n  console.log('howdie')\n}\n\nlet key = 0;\nlet i = [\"⤶\", \"⤈\" ,\"⤷\"]\nlet LAYERS = [[ 0.25, 0xff7700, 1 ], [ 0.5, 0xff1100, 1 ], [ 0.6, 0xffaa00, 0.75 ]]\nlet LAYERS1 = [[ 0.25, 0xff7900, 1 ], [ 0.5, 0xfa1100, 1 ], [ 0.6, 0xffa900, 0.75 ]]\nlet LAYERS2 = [[ 0.25, 0xff7200, 1 ], [ 0.6, 0x20B2AA, 0.75 ]]\nlet LAYERS3 = [[ 0.5, 0x7CFC00, 1 ], [ 0.6, 0xffaa00, 0.75 ]]\n\nlet UI_STATE = 1;\n\nconst UI_STATES = Object.freeze({\n  BEGIN :1,\n  INTENT:2,\n  NAV   :3,\n  ROOM  :4,\n  LAYERS:5,\n  MAP   :6\n})\n\nconst SPACE_STATE = Object.freeze({\n  FLOW: 1,\n  LOCAL: 2,\n  GLOBAL: 3\n})\n\nconst changeState = (NEXT_STATE: any) => {\n  console.log(`changing state: ${NEXT_STATE}`)\n  UI_STATE = NEXT_STATE\n}\n\nfunction Start(props: any){\n  const [isGo, setGo] = useState(true);\n  \n  return(\n    <div className=\"go-wrapper\">\n      <button className=\"but\"\n        style={{cursor: 'pointer'}}\n        onMouseEnter={() => setGo(false)}\n        onMouseLeave={() => setGo(true)}\n        onClick={() => props.setState(UI_STATES.INTENT)}\n      > {isGo ? 'go' : 'x'}</button>\n    </div>\n  )\n}\n\nfunction Nav(props: any){\n  const list = [2,15,60]\n  let controls = 0\n  // const setDirection\n  \n  const nav = list.map((count) => {\n    return <State count={count} direction={controls++} setState={props.setState}/>\n  })\n  \n  return (\n    <div  className=\"nav\">\n      <div style={{ width: '100%'} as React.CSSProperties}>{\"choose :\"} </div>\n      <div  className=\"spaces\" >\n        {nav}\n      </div>\n    </div>\n  )\n}\n\n\nfunction State (props: any) {\n\n  return (\n      <div className=\"space\" onClick={() =>{\n        console.log('setting room')\n        props.setState(UI_STATES.ROOM)\n      }\n      }> {\n        (key < 1) ? (\n          <div>\n            <img src={less} width={\"50%\"} style={{display: 'inline-block'}}/>\n            <span style={{display: 'inherit'}}>\n            <br />\n            {i[key++]}\n            {\"  \"}\n            {props.count}\n            </span>\n          </div>\n        ) : (\n          <div>\n          <img src={key == 1 ? line : more} width={\"50%\"} style={{display: 'inline-block'}}/>\n            <span style={{display: 'inherit'}}>\n          <br />\n          {props.count}\n          {\"  \"}\n          {i[key++]}\n          </span>\n          </div>\n        )\n      }\n      </div>\n    )\n}\n\nfunction Header(props: any){\n  return(\n    <div className='header'>\n      wiflo°\n      <div style={{color: 'grey', paddingTop: '10px'}}>\n        about us\n      </div>\n    </div>\n    )\n}\n\nfunction Footer(props: any){\n  \n  const globalToggle = React.useCallback(() => {\n    props.setControl(SPACE_STATE.GLOBAL)\n    props.setState(UI_STATES.BEGIN)\n    key = 0\n  },[]);\n  \n  const flowToggle = React.useCallback(() => {\n    props.setControl(SPACE_STATE.FLOW)\n    key = 0\n  },[]);\n  \n  const selfToggle = React.useCallback(() => {\n    props.setControl(SPACE_STATE.LOCAL)\n    key = 0\n  },[]);\n  \n  return(\n    <div className='footer'>\n      <a style={{textDecoration: 'none', color: 'grey', cursor: 'pointer'}}>\n        <span onClick={globalToggle}>◯&nbsp;&nbsp;&nbsp;JOIN&nbsp;&nbsp;&nbsp;</span>\n      </a>\n      {\"|\"}\n      <a style={{textDecoration: 'none', color: 'grey', cursor: 'pointer'}}>\n        <span onClick={flowToggle}>&nbsp;&nbsp;&nbsp;▲&nbsp;&nbsp;&nbsp;START&nbsp;&nbsp;&nbsp;▲&nbsp;&nbsp;&nbsp;</span>\n      </a>\n      {\"|\"}\n      <a style={{textDecoration: 'none', color: 'grey', cursor: 'pointer'}}>\n        <span onClick={selfToggle}>&nbsp;&nbsp;&nbsp;SELF&nbsp;&nbsp;&nbsp;Σ</span>\n      </a>\n    </div>\n    )\n}\n\nfunction Here() {\n  return (\n      <div className=\"here\"></div>\n    )\n}\n\nfunction Intention(props: any){\n  const [isGo, setGo] = useState(true);\n   \n  return(\n      <div className='intent'>\n        <input style={{textAlign: 'center'} as React.CSSProperties} type=\"text\" name=\"intention=v1\" placeholder=\"set intention\" className=\"intention\"/>\n        <br/>\n        <button className=\"but\"\n          onMouseEnter={() => setGo(false)}\n          onMouseLeave={() => setGo(true)}\n          onClick={() => props.setState(UI_STATES.NAV)}\n        >»</button>\n      </div>\n    )\n}\n\nfunction Room(){\n  const [dots, setDots] = useState('waiting');\n  const [participants, setParticipants] = useState([] as  any);\n  console.log('in the room')\n  // const participants = this.props.particapants\n  \n  // const participants = [\n  //     [[ 0.25, 0xff7700, 1 ], [ 0.5, 0xff1100, 1 ], [ 0.75, 0xffaa00, 0.75 ]],\n  //     // [[ 0.25, 0xff7700, 1 ], [ 0.5, 0xff9900, 1 ], [ 0.75, 0xffaa00, 0.75 ]]\n  //   ]\n  \n  // const participantAuras = participants.map((ring) => {\n  //   return <Aura essence={ring}/>\n  // })\n  \n  let loading = 'waiting'\n  let count = 0\n  // const participants = []\n  \n  useEffect(() => {\n      \n      \n    const interval = setInterval(() => {\n      \n      if(count < 3){\n        count == 0 && participants.push(<Aura /* here */ WIDTH={window.innerWidth/8} HEIGHT={window.innerHeight/8} essence={LAYERS1}/>)\n        count == 1 && participants.push(<Aura /* here */ WIDTH={window.innerWidth/8} HEIGHT={window.innerHeight/8} essence={LAYERS2}/>)\n        count == 2 && participants.push(<Aura /* here */ WIDTH={window.innerWidth/8} HEIGHT={window.innerHeight/8} essence={LAYERS3}/>)\n      }\n      \n      setParticipants(participants)\n      \n      let i = 0\n      while(i <= count) {\n        setDots(dots + \"...\")\n        i++\n      \n      }\n       \n      if(count == 3) {\n        count = 0\n        setDots('breath')\n        clearInterval(interval)\n      } else {\n        count += 1\n      }\n      \n      \n    }, 1000)\n    \n    \n    return () => clearInterval(interval);\n  }, []);\n  \n  return (\n    \n      <div className=\"nav\">\n        <div style={{alignText: 'center', width: '100%'} as React.CSSProperties} >{dots}</div>\n        <br />\n        <br />\n\n        <Player />\n        <br />\n        <br />\n        <br />\n        <div  className=\"spaces\" >\n          {participants}\n        </div>\n      </div>\n      \n    )\n}\n    \nfunction Layer(props: any) {\n  return (\n      <div>\n        <span>\n          <Aura WIDTH={window.innerWidth/4} HEIGHT={window.innerHeight/4} essence={[props.essence]}/>\n        </span>\n        <span>\n          Ξ 2\n        </span>\n        <br />\n        <span>\n          {\"|===============>--------]\"}\n        </span>\n        <br />\n        <br />\n        <button className=\"but-sub\">\n          +\n        </button>\n        <button className=\"but-sub\">\n          -\n        </button>\n      </div>\n    )\n}\n\nfunction Subscriptions(props: any){\n    \n    const split = props.layers.map((essence: any) => {\n      // console.log(layer)\n      return <Layer essence={essence} />\n    })\n  \n    return (\n      <div className=\"spaces\" >\n        {split}\n      </div>\n    )\n}\n\nfunction record(){\n\n}\n\nfunction broadcast(){\n   audioService = new AudioService();\n   audioService.init()\n}\n\nfunction dial(){\n\n  if (window !== null) {\n    // continue - error suppressed when used in this way.\n    // console.log(window.document!.getElementById('invite')!.value!)\n    let inviteCode = (document.getElementById('invite') as HTMLInputElement).value;\n    console.log(inviteCode)\n    \n    audioService.audioBridge.thread.joinExternalRoom(inviteCode).then((threadId:any ) => {\n      console.log('threadId')\n      console.log(threadId)\n      // this.setRoom.bind(this)\n    \n    })\n\n    audioService.audioBridge.thread.onMessage().subscribe((threadEvent:any) => {\n      const m = threadEvent.event.patch;\n      console.log('------------------')\n      console.log(m)\n\n      // messages.push(m);\n      // this.setState({ messages: messages });\n    });\n  }\n}\n\nfunction Controller (props: any) {\n\n\n\n  return (\n      <>  \n          <div className=\"controller\">\n          <input className=\"invite\" id=\"invite\" placeholder=\"invite\"></input>\n          <button className=\"controls\" onClick={broadcast}>broadcast</button>\n          <button className=\"controls\" onClick={dial}>dial</button>\n          <button className=\"controls\" onClick={record}>■</button>\n          </div>\n      </>\n    )\n}\n\nfunction Main(){\n  \n  const [state, setState] = useState(1)\n  const [control, setControl] = useState(1)\n  \n  const view = [] as  any;\n  state < 4 && view.push(<Header />)\n  control == 1 && view.push(<Aura /* here */ WIDTH={window.innerWidth/4} HEIGHT={window.innerHeight/4} essence={LAYERS}/>)\n  \n  switch(control){\n    case 1:\n      switch(state){\n        case 1:\n          view.push (    <Start setState={setState}/>        )\n          break;\n        case 2:\n          view.push (    <Intention setState={setState}/>    )\n          break;\n        case 3:\n          view.push (    <Nav setState={setState}/>          )\n          break;\n        case 4:\n          console.log('setting room #2')\n          view.push (    <Room {...setState}/>         )\n          break;\n      }\n      break;\n    case 2:\n      view.push(<Aura essence={LAYERS}/>)\n      view.push(<Subscriptions layers={LAYERS}/>)\n      break;\n    case 3:\n      view.push(<Space />)\n      break;\n  }\n  \n  if (state < 4){\n    view.push(<Footer setControl={setControl} setState={setState}/>)\n\n  }else {\n    view.push(<Controller />)\n\n  }\n\n  return view\n  // })\n\n        // }\n}\n\n\n\nclass App extends React.Component {\n  render() {\n    return(\n        <div className=\"App\">\n          <Main />\n        </div>\n      )\n  }\n}\n\n// class App extends React.Component {\n//   static contextType = ChatContext;\n//   private username = React.createRef()\n//   private textInput = React.createRef()\n//   private messagesEnd = React.createRef()\n//   state: ChatState = {\n//     /**\n//      * We'll use the ChatInstance so they match our thread schema right away.\n//      * This first message wont actually be written to the chat.\n//      */\n//     messages: [\n//       {\n//         _id: '',\n//         text: 'Welcome! Type a message and press Send Message to continue the chat.',\n//         author: 'Bot'\n//       }\n//     ],\n//     input: '',\n//     username: 'unknown'\n//   }\n\n//   setupObservables = () => {\n//     const observable = this.context.onMessage();\n\n//     observable.subscribe((threadEvent: any) => {\n//       const m: ChatInstance = threadEvent.event.patch;\n//       let messages = this.state.messages;\n\n//       messages.push(m);\n//       this.setState({ messages: messages });\n//     });\n//   }\n//   componentDidMount () {\n\n//     audioService.init()\n\n//     //initiate thread connection\n//     this.context.init().then(() => {\n//       this.setupObservables()\n//       let room = window.location.hash.replace('#', '');\n//       if (room && room !== '') {\n//         this.context.rejoinOpenRoom().then((threadID: ThreadID) => {\n//           this.setRoom(threadID)\n//         })\n//       } \n//     })\n//     getUsername().then((username) => {\n//       this.setState({username})\n//     })\n//   }\n\n//   componentDidUpdate(prevProps: any, prevState: ChatState) {\n//     if (prevState.messages.length < this.state.messages.length) {\n//       this.scrollToBottom()\n//     }\n//   }\n\n//   componentWillUnmount () {\n//     this.context.disconnect();\n//   }\n\n//   setRoom(threadID: ThreadID) {\n\n//     this.context.getInfoString().then((info: string) => {\n//       const b = Buffer.from(info)\n//       this.setState({invite: b.toString('hex')})\n//       this.setupObservables()\n//     })\n\n//     this.setState({\n//       threadID,\n//     })\n//   }\n//   createNewRoom () {\n//     console.log('test')\n//     this.context.startNewRoom().then(this.setRoom.bind(this))\n//   }\n//   joinInvite() {\n//     console.log('join invite')\n//     // @ts-ignore\n//     const info = this.textInput.current.value\n//     if (info === '') {\n//       throw new Error('Invite required to join')\n//     }\n//     const json = Buffer.from(info, 'hex').toString()\n//     const invite = JSON.parse(json)\n//     console.log(invite)\n//     // this.context.joinExternalRoom(invite).then(this.setRoom.bind(this))\n\n//     audioService.audioBridge.thread.joinExternalRoom(invite).then((threadId:any ) => {\n//       console.log('threadId')\n//       console.log(threadId)\n//       // this.setRoom.bind(this)\n    \n//     })\n\n//     audioService.audioBridge.thread.onMessage().subscribe((threadEvent:any) => {\n//       const m = threadEvent.event.patch;\n//       console.log('------------------')\n//       console.log(m)\n\n//       // messages.push(m);\n//       // this.setState({ messages: messages });\n//     });\n//   }\n//   scrollToBottom = () => {\n//     // @ts-ignore\n//     this.messagesEnd.scrollIntoView({ behavior: \"smooth\" })\n//   }\n//   renderUsername() {\n//     return (\n//       <p>\n//         username:\n//         {/* \n//           // @ts-ignore */}\n//         <FormControl defaultValue={this.state.username} ref={this.username}/>\n//       </p>\n//     )\n//   }\n//   renderSend() {\n//     const handleMessage = (): void => {\n//       if (this.state.input !== '') {\n//         this.context.send({\n//           _id: '',\n//           text: this.state.input,\n//           // @ts-ignore\n//           author: this.username.current.value\n//         });\n//         this.setState({ input: '' });\n//       }\n//     }\n//     return (\n//       <p>\n//         <button onClick={() => { handleMessage() }}>\n//           Send Message\n//         </button>\n//       </p>\n//     )\n//   }\n//   renderInput () {\n//     const updateInput = (e: React.ChangeEvent<HTMLInputElement>): void => {\n//       this.setState({ input: e.target.value });\n//     }\n//     return (\n//       <input\n//         className=\"App-Textarea\"\n//         placeholder=\"Type your messsage here...\"\n//         onChange={updateInput}\n//         value={this.state.input}\n//       />\n//     )\n//   }\n\n//   renderChat () {\n//     return (\n//       <div className=\"App-chatbox\">\n//         {this.state.messages.map((msg: ChatInstance, idx: number) => {\n//           return (\n//             <div key={idx}>\n//               <p>{msg.author}</p>\n//               <p>\n//                 {msg.text}\n//               </p>\n//             </div>\n//           );\n//         })}\n\n//         {/* \n//           // @ts-ignore */}\n//         <div style={{ float:\"left\", clear: \"both\" }} ref={this.messagesEnd}>\n//         </div>\n//       </div>\n//     )\n//   }\n\n//   renderModal () {\n//     return (\n//       <Modal show={this.state.threadID === undefined} animation={false}>\n//         <Modal.Header closeButton>\n//           <Modal.Title id=\"contained-modal-title-vcenter\">\n//             Start Chat\n//           </Modal.Title>\n//         </Modal.Header>\n//         <Modal.Body>\n//         <InputGroup>\n//           {/* \n//           // @ts-ignore */}\n//           <FormControl as=\"textarea\" ref={this.textInput}/>\n//         </InputGroup>\n//         </Modal.Body>\n//         <Modal.Footer>\n//           <Button variant=\"success\" onClick={this.joinInvite.bind(this)}>Join Invite</Button>\n//           <Button onClick={this.createNewRoom.bind(this)}>Create New Room</Button>\n//         </Modal.Footer>\n//       </Modal>\n//     );\n//   }\n\n//   renderInvite() {\n//     return (\n//       <p>\n//         <CopyToClipboard text={this.state.invite} >\n//           <button>Copy invite clipboard</button>\n//         </CopyToClipboard>\n//       </p>\n//     )\n//   }\n\n//   render () {\n\n//     return (\n//       <div className=\"App\">\n//         <img src={logo} className=\"App-logo\" alt=\"logo\" />\n//         {this.state.threadID && this.renderUsername()}\n//         {this.state.threadID && this.renderChat()}\n//         {this.state.threadID && this.renderInput()}\n//         {this.state.threadID && this.renderSend()}\n//         {this.state.threadID && this.renderInvite()}\n//         {!this.state.threadID && this.renderModal()}\n//       </div>\n//     );\n//   }\n// }\n\nexport default App;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      (process as { env: { [key: string]: string } }).env.PUBLIC_URL,\n      window.location.href\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import React, { createContext, useContext } from 'react';\nimport { ThreadService } from './ThreadService';\n\nexport const ChatContext: React.Context<ThreadService> = createContext(new ThreadService());\n\n// functional component context hook\nexport const useChat = () => useContext(ChatContext);\n","import 'bootstrap/dist/css/bootstrap.css';\nimport React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\nimport { ThreadService } from './ThreadService';\nimport { ChatContext } from './ChatContext';\n\nconst chat = new ThreadService();\n\n\nReactDOM.render(\n  <ChatContext.Provider value={chat}>\n    <App />\n  </ChatContext.Provider>\n  , document.getElementById('root'));\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}