(this["webpackJsonphub-threaddb-chat"]=this["webpackJsonphub-threaddb-chat"]||[]).push([[0],{152:function(e,t){},335:function(e,t,n){e.exports=n.p+"static/media/less_1.906bb524.png"},336:function(e,t,n){e.exports=n.p+"static/media/more_1.b474c75f.png"},337:function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASgAAACjCAYAAAA5B4O2AAAB00lEQVR42u3YoRWAMBBEwas4NaSUOGw6QEQiKIFSDjAoCjgx89628MVGAFSVmduzy8ys2t5A7QlQkEABAgUgUIBAAQgUIFAAAgUgUIBAAQgUIFAAAgUgUIBAAQgUIFAAAgUgUIBAAQgUIFAAAgUgUIBAAQgUIFAAAgUgUIBAAQgUIFAAAgUIFIBAAQgUIFAAAgUIFIBAAQgUIFAAAgUIFIBAAQgUIFAAAgUIFIBAAQgUIFAAAgUIFIBAAQgUIFAAAgUIFIBAAQIlUIBAAQgUIFAAAgUIFIBAAQgUIFAAAgUIFIBAAQgUIFAAAgUIFIBAAfwEaq11jDHSzKzaorV2RUSamZXbnPPsvaeZWbX5oAAnOYBAAQIFIFCAQAEIFIBAAQIFIFCAQAEIFIBAAQIFIFCAQAEIFIBAAQIFIFCAQAEIFIBAAQIFIFCAQAEIFIBAAQIFIFCAQAEIFCBQAAIFIFCAQAEIFCBQAAIFIFCAQAEIFCBQAAIFIFCAQAEIFCBQAAIFIFCAQAEIFCBQAAIFIFCAQAEIFCBQAAIFCJRAAQIFIFCAQAEIFCBQAAIFIFCAQAEIFCBQAAIFIFCAQAEIFCBQAAIFIFCAQAEIFCBQAAIF8LkBHxC8fZTjPaMAAAAASUVORK5CYII="},338:function(e,t,n){e.exports=n(871)},344:function(e,t,n){},345:function(e,t,n){},347:function(e,t){function n(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"blob";this.url=e,this.listeners={},this.socketEvents=["open","close","error","message"],this.socket=new WebSocket(e),this.readyState=this.socket.readyState,this.protocol=this.socket.protocol,this.extensions=this.socket.extensions,this.bufferedAmount=this.socket.bufferedAmount,this.binaryType=n,this.socket.binaryType=this.binaryType;var r=this,a=function(e){var n=new WebSocket(e);for(var r in n.binaryType=t.socket.binaryType,t.socketEvents)for(var a in t.listeners[r])n.addEventListener(r,a);t.socket.addEventListener("close",o),t.socket=n,t.dispatchEvent("reconnect",t.socket)};function o(e){1011==e.code?console.log("Could not connect to websocket. reason=".concat(e.reason)):a(r.url)}this.socket.addEventListener("close",o)}function r(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"arraybuffer";n.call(this,e,r),this.appEvents=["started","stopped"];var a=function(e){if("string"===typeof e.data)if("ping"==e.data)t.socket.send("pong");else if(t.appEvents.includes(e.data))t.dispatchEvent(e.data,e);else try{var n=JSON.parse(e.data);"meta"in n&&t.dispatchEvent("metadata",n.meta)}catch(e){}else{var r=btoa(new Uint8Array(e.data).reduce((function(e,t){return e+String.fromCharCode(t)}),""));t.dispatchEvent("binary",r)}};this.addEventListener("message",a)}n.prototype.addEventListener=function(e,t){this.socketEvents.includes(e)&&this.socket.addEventListener(e,t),e in this.listeners||(this.listeners[e]=[]),this.listeners[e].push(t)},n.prototype.removeEventListener=function(e,t){if(e in this.listeners)for(var n=0,r=this.listeners[e].length;n<r;n++)if(this.listeners[e][n]===t)return void this.listeners[e].splice(n,1)},n.prototype.dispatchEvent=function(e,t){if(e in this.listeners)for(var n=0;n<this.listeners[e].length;n++)this.listeners[e][n].call(this,t)},n.prototype.send=function(e){this.socket.send(e)},r.prototype=Object.create(n.prototype),Object.defineProperty(r.prototype,"constructor",{value:r,enumerable:!1,writable:!0})},350:function(e,t){},352:function(e,t){},509:function(e,t){},524:function(e,t){},526:function(e,t){},554:function(e,t){},555:function(e,t){},560:function(e,t){},562:function(e,t){},586:function(e,t){},734:function(e,t){},743:function(e,t){},745:function(e,t){},871:function(e,t,n){"use strict";n.r(t);n(339);var r=n(2),a=n.n(r),o=n(332),i=n.n(o),c=(n(344),n(16)),s=n(17),u=n(35),l=n(34),d=n(36),h=(n(345),n(0)),m=n.n(h),p=n(13),f=(n(347),function(){function e(t,n){var r=this;Object(c.a)(this,e),this.audioRecorder=null,this.audioStreamer=t,this.audioBridge=n,this.audioStreamer.getRecorder().then((function(e){r.audioRecorder=e}))}return Object(s.a)(e,[{key:"start",value:function(){(void 0).start()}},{key:"stop",value:function(){(void 0).stop()}},{key:"transmitAudioData",value:function(e){var t=btoa(new Uint8Array(e).reduce((function(e,t){return e+String.fromCharCode(t)}),"")),n=this.constructData("binary",t);this.audioBridge.send(n)}},{key:"transmitMetadata",value:function(e){var t=this.constructData("metadata",e);this.audioBridge.send(t)}},{key:"transmitStartData",value:function(){var e=this.constructData("started","started");this.audioBridge.send(e)}},{key:"transmitStopData",value:function(){var e=this.constructData("stopped","stopped");this.audioBridge.send(e)}},{key:"constructData",value:function(e,t){var n={};return n.user=Math.random(),n.event=e,n.timestamp=(new Date).getTime(),"metadata"==e?n.data=JSON.stringify(t):"binary"==e&&(n.data=t),n}}]),e}()),v=n(348),g=window.AudioContext||window.webkitAudioContext,b={process:function(e){function t(e){for(var t=new Int16Array(e.length),n=0;n<e.length;n++)t[n]=65535*e[n];return t.buffer}return 1==e.numberOfChannels?t(e.getChannelData(0)):t(function(e){for(var t=[],n=0;n<e.getChannelData(0).length;n++){var r=e.getChannelData(0)[n],a=e.getChannelData(1)[n];t.push(r),t.push(a)}return new Float32Array(t)}(e))},toWav:function(e,t){t.byteLength,e.bytesPerSample;var n,r=e.numChannels||1,a=e.sampleRate||44100,o=e.bytesPerSample||2,i=r*o,c=a*i;n=t.byteLength;var s=new ArrayBuffer(44),u=new DataView(s),l=0;function d(e){for(var t=0;t<e.length;t++)u.setInt8(l+t,e.charCodeAt(t));l+=e.length}function h(e){u.setInt32(l,e,!0),l+=4}function m(e){u.setInt16(l,e,!0),l+=2}d("RIFF"),h(n+36),d("WAVE"),d("fmt "),h(16),m(1),m(r),h(a),h(c),m(i),m(8*o),d("data"),h(n);var p=new Int8Array(s),f=new Int8Array(t),v=new Int8Array(p.byteLength+f.byteLength);return v.set(p),v.set(f,p.byteLength),v.buffer}};function A(e,t,n){t in e||(e[t]=n)}var w=function(){function e(t){Object(c.a)(this,e),this.configuration={},this.audioTransmitter=new f(this,t);A(this.configuration,"sampleRate",44100),A(this.configuration,"channelCount",1),A(this.configuration,"duration",.5),A(this.configuration,"stopDelay",1.2)}return Object(s.a)(e,[{key:"getRecorder",value:function(){var e=this,t=this;return new Promise((function(n,r){var a={audio:{sampleRate:e.configuration.sampleRate,channelCount:e.configuration.channelCount}};navigator.mediaDevices.getUserMedia(a).then((function(r){var a,o=!1,i=new g,c=new MediaRecorder(r);c.addEventListener("dataavailable",(function(n){new Response(n.data).arrayBuffer().then((function(n){i.decodeAudioData(n,(function(n){if(o){var r={encoding:16,sampleRate:n.sampleRate,channels:n.numberOfChannels,bufferSize:n.sampleRate*n.numberOfChannels*e.configuration.duration};return t.audioTransmitter.transmitMetadata(JSON.stringify({meta:r})),void(o=!1)}var a=b.process(n);t.audioTransmitter.transmitAudioData(a)}))}))}));n({start:function(){t.audioTransmitter.transmitStartData("started"),"recording"==c.state&&c.stop(),c.start(),o=!0,a=setInterval((function(){c.stop(),c.start()}),1e3*e.configuration.duration)},stop:function(){clearInterval(a),c.stop(),setTimeout((function(){t.audioTransmitter.transmitStopData("stopped")}),1e3*e.configuration.duration)}})})).catch((function(e){r(e)}))}))}},{key:"getNewPlayer",value:function(e){var t=new g,n=v(t.destination,{context:t,autoend:!0});return{play:function(r){var a={numChannels:e.channels,sampleRate:e.sampleRate,bytesPerSample:e.encoding/8},o=b.toWav(a,r);t.decodeAudioData(o,(function(e){n.write(e)}))},stop:function(){t.close()}}}}]),e}();var y=n(118),E=n(117),I=(n(119),function(){var e=Object(p.a)(m.a.mark((function e(){var t,n,r,a;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,null!==(t=localStorage.getItem("identity"))){e.next=4;break}throw new Error("No identity");case 4:return n=E.Libp2pCryptoIdentity.fromString(t),e.abrupt("return",n);case 8:return e.prev=8,e.t0=e.catch(0),e.prev=10,e.next=13,E.Libp2pCryptoIdentity.fromRandom();case 13:return r=e.sent,a=r.toString(),localStorage.setItem("identity",a),e.abrupt("return",r);case 19:return e.prev=19,e.t1=e.catch(10),e.abrupt("return",e.t1.message);case 22:case"end":return e.stop()}}),e,null,[[0,8],[10,19]])})));return function(){return e.apply(this,arguments)}}()),C=n(874),k=n(865),O="threads.chat.reboot",S=function(){function e(){var t=this;Object(c.a)(this,e),this.threadID=void 0,this.db=void 0,this.identity=void 0,this.room=void 0,this.init=Object(p.a)(m.a.mark((function e(){var n;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,I();case 2:return t.identity=e.sent,n={key:Object({NODE_ENV:"production",PUBLIC_URL:"/wiflo",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0}).REACT_APP_API_KEY||"bq5t3vy4nh4bv6chuveibkjlw5y"},e.next=6,y.Database.withKeyInfo(n,O,void 0,Object({NODE_ENV:"production",PUBLIC_URL:"/wiflo",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0}).REACT_APP_API);case 6:return t.db=e.sent,e.abrupt("return",t);case 8:case"end":return e.stop()}}),e)}))),this.reset=Object(p.a)(m.a.mark((function e(){var n;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("closing"),e.prev=1,console.log(t.db),e.next=5,null===(n=t.db)||void 0===n?void 0:n.close();case 5:console.log("closed!!!"),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),console.log(e.t0);case 11:return console.log("destroy"),e.next=14,new Promise((function(e,t){k.destroy(O,(function(n){void 0!==n&&t(n),e()}))}));case 14:return console.log("initinnnng"),e.abrupt("return",t.init());case 16:case"end":return e.stop()}}),e,null,[[1,8]])}))),this.storeCurrentRoom=function(){var e=t.threadID.toString();window.location.hash=e},this.startNewRoom=Object(p.a)(m.a.mark((function e(){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("starting room"),t.identity){e.next=3;break}throw new Error("Identity not found");case 3:if(t.db){e.next=5;break}throw new Error("Database not setup");case 5:return e.next=7,t.reset();case 7:return console.log("starting"),console.log(t.identity),console.log(t.threadID),e.prev=10,e.next=13,t.db.start(t.identity,{threadID:t.threadID});case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(10),console.log(e.t0);case 18:return console.log("collection"),e.next=21,t.createCollection();case 21:return t.storeCurrentRoom(),e.abrupt("return",t.threadID);case 23:case"end":return e.stop()}}),e,null,[[10,15]])}))),this.joinExternalRoom=function(){var e=Object(p.a)(m.a.mark((function e(n){var r;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("joining room"),t.identity){e.next=3;break}throw new Error("Identity not found");case 3:return e.next=5,t.reset();case 5:if(t.db){e.next=7;break}throw new Error("Database not setup");case 7:return console.log("payload"),console.log(t.identity),console.log(n),console.log(t.db),e.next=13,t.db.startFromInfo(t.identity,n);case 13:if(!((r=e.sent)instanceof Error)){e.next=16;break}throw r;case 16:return t.threadID=t.db.threadID||t.threadID,console.log("creating collection"),e.next=20,t.createCollection();case 20:return console.log("store current room"),t.storeCurrentRoom(),console.log("returning with id"),e.abrupt("return",t.threadID);case 24:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),this.rejoinOpenRoom=Object(p.a)(m.a.mark((function e(){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.identity){e.next=2;break}throw new Error("Identity not found");case 2:if(t.db){e.next=4;break}throw new Error("Database not setup");case 4:return e.next=6,t.db.start(t.identity,{threadID:t.threadID});case 6:return e.next=8,t.createCollection();case 8:return t.threadID=t.db.threadID||t.threadID,e.abrupt("return",t.db.threadID);case 10:case"end":return e.stop()}}),e)}))),this.createCollection=Object(p.a)(m.a.mark((function e(){var n;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("create collection"),t.db){e.next=3;break}throw new Error("No db");case 3:if(!(n=t.db.collections).get("basic-chat")){e.next=8;break}t.room=n.get("basic-chat"),e.next=11;break;case 8:return e.next=10,t.db.newCollection("basic-chat",x);case 10:t.room=e.sent;case 11:t.storeCurrentRoom();case 12:case"end":return e.stop()}}),e)}))),this.getInfoString=Object(p.a)(m.a.mark((function e(){var n;return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.db){e.next=2;break}throw new Error("No db");case 2:return e.next=4,t.db.getDBInfo(!0);case 4:return n=e.sent,e.abrupt("return",JSON.stringify(n));case 6:case"end":return e.stop()}}),e)}))),this.send=function(){var e=Object(p.a)(m.a.mark((function e(n){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.room){e.next=2;break}throw new Error("DB not ready");case 2:return e.next=4,t.room.insert(n);case 4:if(t.db&&t.db.threadID){e.next=6;break}throw new Error("DB not ready");case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();var n=window.location.hash.replace("#","");this.threadID=n?y.ThreadID.fromString(n):y.ThreadID.fromRandom()}return Object(s.a)(e,[{key:"onMessage",value:function(){if(!this.db)throw new Error("DB not setup");return Object(C.a)(this.db.emitter,"basic-chat.*.0")}},{key:"disconnect",value:function(){this.db&&this.db.close()}}]),e}(),x={$schema:"http://json-schema.org/draft-07/schema#",definitions:{ChatBasic:{title:"ChatBasic",type:"object",properties:{_id:{type:"string"},text:{type:"string"},author:{type:"string"}},required:["text","author","_id"]}}},F=function(){function e(){Object(c.a)(this,e),this.thread=new S,this.audioStream=new w(this),this.ready=!1}return Object(s.a)(e,[{key:"init",value:function(){var e=this;this.audioStream.getRecorder().then((function(e){e.start()})),this.thread.init().then((function(t){console.log("init audio bridge"),e.ready=!0,e.thread.startNewRoom().then((function(t){console.log("Thread ready: ".concat(t)),console.log(e.thread),e.thread.onMessage().subscribe((function(e){var t=e.event.patch;console.log("------------------"),console.log(t)})),e.thread.getInfoString().then((function(e){console.log("INFO"),console.log(e)}))})).catch((function(e){console.log(e)}))}))}},{key:"joinExternal",value:function(){}},{key:"send",value:function(e,t){this.ready?this.thread.send({_id:"",author:"vitalik"+Math.random(),text:e}):console.log("not ready")}}]),e}(),D=function e(){var t=this;Object(c.a)(this,e),this.threadID=void 0,this.db=void 0,this.audioBridge=void 0,this.init=Object(p.a)(m.a.mark((function e(){return m.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("initialing audio"),setInterval((function(){console.log("testing"),t.audioBridge.send("howdie")}),1e3);case 2:case"end":return e.stop()}}),e)}))),this.audioBridge=new F,this.audioBridge.init()};var j=function(e){Object(u.a)(n,e);var t=Object(l.a)(n);function n(){return Object(c.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n,[{key:"componentDidMount",value:function(){document.querySelector(".record"),document.querySelector(".stop");var e,t=document.querySelector(".sound-clips"),n=document.querySelector(".visualizer"),r=document.querySelector(".main-controls"),a=n.getContext("2d");if(navigator.mediaDevices.getUserMedia){console.log("getUserMedia supported.");var o=[];navigator.mediaDevices.getUserMedia({audio:!0}).then((function(r){var s=new MediaRecorder(r);!function(t){e||(e=new AudioContext);var r=e.createMediaStreamSource(t),o=e.createAnalyser();o.fftSize=1024;var i=o.frequencyBinCount,c=new Uint8Array(i),s=e.createOscillator(),u=e.createGain();r.connect(u),u.connect(e.destination),s.start(0),r.connect(o),function e(){var t=n.width,r=n.height;requestAnimationFrame(e),o.getByteTimeDomainData(c),a.fillStyle="rgb(255, 255, 255, 1)",a.fillRect(0,0,t,r),a.lineWidth=2,a.strokeStyle="RGBA(84, 84, 84, 1)",a.beginPath();for(var s=1*t/i,u=0,l=0;l<i;l++){var d=c[l]/128*r/2;0===l?a.moveTo(u,d):a.lineTo(u,d),u+=s}a.lineTo(n.width,n.height/2),a.stroke()}()}(r),console.log(r),s.onstop=function(e){console.log("data available after MediaRecorder.stop() called.");var n=prompt("Enter a name for your sound clip?","My unnamed clip"),r=document.createElement("article"),a=document.createElement("p"),i=document.createElement("audio"),c=document.createElement("button");r.classList.add("clip"),i.setAttribute("controls",""),a.textContent=null===n?"My unnamed clip":n,r.appendChild(i),r.appendChild(a),r.appendChild(c),t.appendChild(r),i.controls=!0;var s=new Blob(o,{type:"audio/ogg; codecs=opus"});o=[];var u=window.URL.createObjectURL(s);i.src=u,console.log("recorder stopped"),c.onclick=function(e){var t=e.target;t.parentNode.parentNode.removeChild(t.parentNode)},a.onclick=function(){var e=a.textContent,t=prompt("Enter a new name for your sound clip?");a.textContent=null===t?e:t}},s.ondataavailable=function(e){console.log(e.data),o.push(e.data);var t=new Blob(o,{type:"audio/ogg; codecs=opus"});2==c&&(console.log("new audio"),i.push(new Audio(URL.createObjectURL(t))),o=[],c=0),c++}}),(function(e){console.log("The following error occured: "+e)}))}else console.log("getUserMedia not supported on your browser!");var i=[],c=0;setInterval((function(){if(i.length>0){var e=i[0];e.addEventListener("canplaythrough",(function(t){e.play()}))}}),2e3),window.onresize=function(){n.width=r.offsetWidth},window.onresize()}},{key:"render",value:function(){return a.a.createElement(a.a.Fragment,null,a.a.createElement("section",{className:"main-controls",style:{width:"100%"}},a.a.createElement("canvas",{className:"visualizer",height:"200px",style:{width:"500px"}}),a.a.createElement("div",{id:"buttons"})))}}]),n}(r.Component),B=n(5),U=n(172),T={marginTop:50,height:350},R={merge:function(e,t,n){var r;console.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead."),t instanceof B.h&&(t.matrixAutoUpdate&&t.updateMatrix(),r=t.matrix,t=t.geometry),e.merge(t,r,n)},randomPointInTriangle:function(){var e=new B.t;return function(t,n,r){var a=new B.t,o=Math.random(),i=Math.random();o+i>1&&(o=1-o,i=1-i);var c=1-o-i;return a.copy(t),a.multiplyScalar(o),e.copy(n),e.multiplyScalar(i),a.add(e),e.copy(r),e.multiplyScalar(c),a.add(e),a}}(),randomPointInFace:function(e,t){var n,r,a;return n=t.vertices[e.a],r=t.vertices[e.b],a=t.vertices[e.c],R.randomPointInTriangle(n,r,a)},randomPointsInGeometry:function(e,t){var n,r,a,o,i,c=e.faces,s=e.vertices,u=c.length,l=0,d=[];for(r=0;r<u;r++)a=s[(n=c[r]).a],o=s[n.b],i=s[n.c],n._area=R.triangleArea(a,o,i),l+=n._area,d[r]=l;var h,m,p,f=[],v={};for(r=0;r<t;r++)h=Math.random()*l,p=h,m=function e(t,n){if(n<t)return t;var r=t+Math.floor((n-t)/2);return d[r]>p?e(t,r-1):d[r]<p?e(r+1,n):r}(0,d.length-1),f[r]=R.randomPointInFace(c[m],e),v[m]?v[m]+=1:v[m]=1;return f},randomPointsInBufferGeometry:function(e,t){var n,r,a,o,i=e.attributes.position.array,c=0,s=[];r=new B.t,a=new B.t,o=new B.t;var u=i.length/9;for(n=0;n<u;n++)r.set(i[9*n+0],i[9*n+1],i[9*n+2]),a.set(i[9*n+3],i[9*n+4],i[9*n+5]),o.set(i[9*n+6],i[9*n+7],i[9*n+8]),c+=R.triangleArea(r,a,o),s.push(c);var l,d,h,m=[];for(n=0;n<t;n++)l=Math.random()*c,h=l,d=function e(t,n){if(n<t)return t;var r=t+Math.floor((n-t)/2);return s[r]>h?e(t,r-1):s[r]<h?e(r+1,n):r}(0,s.length-1),r.set(i[9*d+0],i[9*d+1],i[9*d+2]),a.set(i[9*d+3],i[9*d+4],i[9*d+5]),o.set(i[9*d+6],i[9*d+7],i[9*d+8]),m[n]=R.randomPointInTriangle(r,a,o);return m},triangleArea:function(){var e=new B.t,t=new B.t;return function(n,r,a){return e.subVectors(r,n),t.subVectors(a,n),e.cross(t),.5*e.length()}}(),center:function(e){return console.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead."),e.center()}},L=function(e){Object(u.a)(n,e);var t=Object(l.a)(n);function n(){var e;Object(c.a)(this,n);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))).sceneSetup=function(){var t=e.mount.clientWidth,n=e.mount.clientHeight;e.scene=new B.o,e.scene.background=new B.b("white"),e.camera=new B.j(75,t/n,.1,1e3),e.camera.position.z=9,e.controls=new U.a(e.camera,e.mount),e.renderer=new B.u,e.renderer.setSize(t,n),e.mount.appendChild(e.renderer.domElement)},e.addCustomSceneObjects=function(){var t=new B.p(5,32,32),n=new B.p(5,32,32),r=R.randomPointsInGeometry(n,50);n.vertices=r;new B.l(n,new B.m({color:255,size:1})),new B.h(n,a);e.scene.add(e.dots);var a=new B.i({color:"grey",wireframe:!0}),o=new B.h(t,a);e.sphere=o,e.scene.add(e.sphere);var i=[];i[0]=new B.k(16777215,1,0),i[1]=new B.k(16777215,1,0),i[2]=new B.k(16777215,1,0),i[0].position.set(0,200,0),i[1].position.set(100,200,100),i[2].position.set(-100,-200,-100),e.scene.add(i[0]),e.scene.add(i[1]),e.scene.add(i[2])},e.startAnimationLoop=function(){e.sphere.rotation.x+=.001,e.sphere.rotation.y+=.001,e.renderer.render(e.scene,e.camera),e.requestID=window.requestAnimationFrame(e.startAnimationLoop)},e.handleWindowResize=function(){var t=e.mount.clientWidth,n=e.mount.clientHeight;e.renderer.setSize(t,n),e.camera.aspect=t/n,e.camera.updateProjectionMatrix()},e}return Object(s.a)(n,[{key:"componentDidMount",value:function(){this.sceneSetup(),this.addCustomSceneObjects(),this.startAnimationLoop(),window.addEventListener("resize",this.handleWindowResize)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.handleWindowResize),window.cancelAnimationFrame(this.requestID),this.controls.dispose()}},{key:"render",value:function(){var e=this;return a.a.createElement("div",null,a.a.createElement("br",null),a.a.createElement("br",null),a.a.createElement("div",{style:{paddingTop:"10px"}},"where would you like to go?"),a.a.createElement("div",{style:T,ref:function(t){return e.mount=t}}),";")}}]),n}(r.Component),N=n(72);window.innerHeight;function Q(){for(var e=new B.a,t=[],n=new B.t,r=0;r<1200;r++)n.x=2*Math.random()-1,n.y=2*Math.random()-1,n.z=2*Math.random()-1,n.normalize(),n.multiplyScalar(450),t.push(n.x,n.y,n.z),n.multiplyScalar(.09*Math.random()+1),t.push(n.x,n.y,n.z);return e.setAttribute("position",new B.d(t,3)),e}var M,W=function(e){Object(u.a)(n,e);var t=Object(l.a)(n);function n(){var e;Object(c.a)(this,n);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return(e=t.call.apply(t,[this].concat(a))).sceneSetup=function(){e.camera=new B.j(80,e.props.WIDTH/e.props.HEIGHT,1,3e3),e.camera.position.z=1e3,e.scene=new B.o;var t,n,r,a,o=e.props.essence,i=Q();for(t=0;t<o.length;++t)a=o[t],r=new B.e({color:a[1],opacity:a[2]}),(n=new B.f(i,r)).scale.x=n.scale.y=n.scale.z=a[0],n.userData.originalScale=a[0],n.rotation.y=Math.random()*Math.PI,n.updateMatrix(),e.scene.add(n);e.scene.background=new B.b("white"),e.renderer=new B.u({antialias:!0}),e.renderer.setPixelRatio(window.devicePixelRatio),e.renderer.setSize(e.props.WIDTH,e.props.HEIGHT);var c=Object(N.a)(e);setInterval((function(){var e=Q();c.scene.traverse((function(t){t.isLine&&(t.geometry.dispose(),t.geometry=e)}))}),1e3),e.mount.appendChild(e.renderer.domElement)},e.addCustomSceneObjects=function(){var t=new B.p(5,32,32),n=new B.i({color:"grey",wireframe:!0}),r=new B.h(t,n);e.sphere=r,e.scene.add(e.sphere);var a=[];a[0]=new B.k(16777215,1,0),a[1]=new B.k(16777215,1,0),a[2]=new B.k(16777215,1,0),a[0].position.set(0,200,0),a[1].position.set(100,200,100),a[2].position.set(-100,-200,-100),e.scene.add(a[0]),e.scene.add(a[1]),e.scene.add(a[2])},e.startAnimationLoop=function(){e.camera.position.y+=.05*(200-e.camera.position.y),e.camera.lookAt(e.scene.position),e.renderer.render(e.scene,e.camera);for(var t=1e-4*Date.now(),n=0;n<e.scene.children.length;n++){var r=e.scene.children[n];if(r.isLine&&(r.rotation.y=t*(n<4?n+1:-(n+1)),n<5)){var a=r.userData.originalScale*(n/5+1)*(1+.5*Math.sin(7*t));r.scale.x=r.scale.y=r.scale.z=a}}requestAnimationFrame(e.startAnimationLoop)},e.handleWindowResize=function(){var t=e.mount.clientWidth,n=e.mount.clientHeight;e.renderer.setSize(t,n),e.camera.aspect=t/n,e.camera.updateProjectionMatrix()},e}return Object(s.a)(n,[{key:"componentDidMount",value:function(){this.sceneSetup(),this.startAnimationLoop(),window.addEventListener("resize",this.handleWindowResize),this.forceUpdate()}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.handleWindowResize)}},{key:"render",value:function(){var e=this;return a.a.createElement("div",{ref:function(t){return e.mount=t}})}}]),n}(r.Component),H=n(335),P=n.n(H),z=n(336),_=n.n(z),G=n(337),q=n.n(G);var V=0,K=["\u2936","\u2908","\u2937"],J=[[.25,16742144,1],[.5,16716032,1],[.6,16755200,.75]],Y=[[.25,16742656,1],[.5,16388352,1],[.6,16754944,.75]],Z=[[.25,16740864,1],[.6,2142890,.75]],X=[[.5,8190976,1],[.6,16755200,.75]],$=Object.freeze({BEGIN:1,INTENT:2,NAV:3,ROOM:4,LAYERS:5,MAP:6}),ee=Object.freeze({FLOW:1,LOCAL:2,GLOBAL:3});function te(e){var t=Object(r.useState)(!0),n=Object(d.a)(t,2),o=n[0],i=n[1];return a.a.createElement("div",{className:"go-wrapper"},a.a.createElement("button",{className:"but",style:{cursor:"pointer"},onMouseEnter:function(){return i(!1)},onMouseLeave:function(){return i(!0)},onClick:function(){return e.setState($.INTENT)}}," ",o?"go":"x"))}function ne(e){var t=0,n=[2,15,60].map((function(n){return a.a.createElement(re,{count:n,direction:t++,setState:e.setState})}));return a.a.createElement("div",{className:"nav"},a.a.createElement("div",{style:{width:"100%"}},"choose :"," "),a.a.createElement("div",{className:"spaces"},n))}function re(e){return a.a.createElement("div",{className:"space",onClick:function(){console.log("setting room"),e.setState($.ROOM)}}," ",V<1?a.a.createElement("div",null,a.a.createElement("img",{src:P.a,width:"50%",style:{display:"inline-block"}}),a.a.createElement("span",{style:{display:"inherit"}},a.a.createElement("br",null),K[V++],"  ",e.count)):a.a.createElement("div",null,a.a.createElement("img",{src:1==V?q.a:_.a,width:"50%",style:{display:"inline-block"}}),a.a.createElement("span",{style:{display:"inherit"}},a.a.createElement("br",null),e.count,"  ",K[V++])))}function ae(e){return a.a.createElement("div",{className:"header"},"wiflo\xb0",a.a.createElement("div",{style:{color:"grey",paddingTop:"10px"}},"about us"))}function oe(e){var t=a.a.useCallback((function(){e.setControl(ee.GLOBAL),e.setState($.BEGIN),V=0}),[]),n=a.a.useCallback((function(){e.setControl(ee.FLOW),V=0}),[]),r=a.a.useCallback((function(){e.setControl(ee.LOCAL),V=0}),[]);return a.a.createElement("div",{className:"footer"},a.a.createElement("a",{style:{textDecoration:"none",color:"grey",cursor:"pointer"}},a.a.createElement("span",{onClick:t},"\u25ef\xa0\xa0\xa0JOIN\xa0\xa0\xa0")),"|",a.a.createElement("a",{style:{textDecoration:"none",color:"grey",cursor:"pointer"}},a.a.createElement("span",{onClick:n},"\xa0\xa0\xa0\u25b2\xa0\xa0\xa0START\xa0\xa0\xa0\u25b2\xa0\xa0\xa0")),"|",a.a.createElement("a",{style:{textDecoration:"none",color:"grey",cursor:"pointer"}},a.a.createElement("span",{onClick:r},"\xa0\xa0\xa0SELF\xa0\xa0\xa0\u03a3")))}function ie(e){var t=Object(r.useState)(!0),n=Object(d.a)(t,2),o=(n[0],n[1]);return a.a.createElement("div",{className:"intent"},a.a.createElement("input",{style:{textAlign:"center"},type:"text",name:"intention=v1",placeholder:"set intention",className:"intention"}),a.a.createElement("br",null),a.a.createElement("button",{className:"but",onMouseEnter:function(){return o(!1)},onMouseLeave:function(){return o(!0)},onClick:function(){return e.setState($.NAV)}},"\xbb"))}function ce(){var e=Object(r.useState)("waiting"),t=Object(d.a)(e,2),n=t[0],o=t[1],i=Object(r.useState)([]),c=Object(d.a)(i,2),s=c[0],u=c[1];console.log("in the room");var l=0;return Object(r.useEffect)((function(){var e=setInterval((function(){l<3&&(0==l&&s.push(a.a.createElement(W,{WIDTH:window.innerWidth/8,HEIGHT:window.innerHeight/8,essence:Y})),1==l&&s.push(a.a.createElement(W,{WIDTH:window.innerWidth/8,HEIGHT:window.innerHeight/8,essence:Z})),2==l&&s.push(a.a.createElement(W,{WIDTH:window.innerWidth/8,HEIGHT:window.innerHeight/8,essence:X}))),u(s);for(var t=0;t<=l;)o(n+"..."),t++;3==l?(l=0,o("breath"),clearInterval(e)):l+=1}),1e3);return function(){return clearInterval(e)}}),[]),a.a.createElement("div",{className:"nav"},a.a.createElement("div",{style:{alignText:"center",width:"100%"}},n),a.a.createElement("br",null),a.a.createElement("br",null),a.a.createElement(j,null),a.a.createElement("br",null),a.a.createElement("br",null),a.a.createElement("br",null),a.a.createElement("div",{className:"spaces"},s))}function se(e){return a.a.createElement("div",null,a.a.createElement("span",null,a.a.createElement(W,{WIDTH:window.innerWidth/4,HEIGHT:window.innerHeight/4,essence:[e.essence]})),a.a.createElement("span",null,"\u039e 2"),a.a.createElement("br",null),a.a.createElement("span",null,"|===============>--------]"),a.a.createElement("br",null),a.a.createElement("br",null),a.a.createElement("button",{className:"but-sub"},"+"),a.a.createElement("button",{className:"but-sub"},"-"))}function ue(e){var t=e.layers.map((function(e){return a.a.createElement(se,{essence:e})}));return a.a.createElement("div",{className:"spaces"},t)}function le(){}function de(){(M=new D).init()}function he(){if(null!==window){var e=document.getElementById("invite").value;console.log(e),M.audioBridge.thread.joinExternalRoom(e).then((function(e){console.log("threadId"),console.log(e)})),M.audioBridge.thread.onMessage().subscribe((function(e){var t=e.event.patch;console.log("------------------"),console.log(t)}))}}function me(e){return a.a.createElement(a.a.Fragment,null,a.a.createElement("div",{className:"controller"},a.a.createElement("input",{className:"invite",id:"invite",placeholder:"invite"}),a.a.createElement("button",{className:"controls",onClick:de},"broadcast"),a.a.createElement("button",{className:"controls",onClick:he},"dial"),a.a.createElement("button",{className:"controls",onClick:le},"\u25a0")))}function pe(){var e=Object(r.useState)(1),t=Object(d.a)(e,2),n=t[0],o=t[1],i=Object(r.useState)(1),c=Object(d.a)(i,2),s=c[0],u=c[1],l=[];switch(n<4&&l.push(a.a.createElement(ae,null)),1==s&&l.push(a.a.createElement(W,{WIDTH:window.innerWidth/4,HEIGHT:window.innerHeight/4,essence:J})),s){case 1:switch(n){case 1:l.push(a.a.createElement(te,{setState:o}));break;case 2:l.push(a.a.createElement(ie,{setState:o}));break;case 3:l.push(a.a.createElement(ne,{setState:o}));break;case 4:console.log("setting room #2"),l.push(a.a.createElement(ce,o))}break;case 2:l.push(a.a.createElement(W,{essence:J})),l.push(a.a.createElement(ue,{layers:J}));break;case 3:l.push(a.a.createElement(L,null))}return n<4?l.push(a.a.createElement(oe,{setControl:u,setState:o})):l.push(a.a.createElement(me,null)),l}var fe=function(e){Object(u.a)(n,e);var t=Object(l.a)(n);function n(){return Object(c.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n,[{key:"render",value:function(){return a.a.createElement("div",{className:"App"},a.a.createElement(pe,null))}}]),n}(a.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var ve=Object(r.createContext)(new S),ge=new S;i.a.render(a.a.createElement(ve.Provider,{value:ge},a.a.createElement(fe,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[338,1,2]]]);
//# sourceMappingURL=main.7dc07630.chunk.js.map